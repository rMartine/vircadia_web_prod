(()=>{"use strict";var e={32101:(e,t,i)=>{i(65363),i(10071);var n=i(98880),o=i(99592),a=i(83673);function s(e,t,i,n,o,s){const r=(0,a.up)("router-view");return(0,a.wg)(),(0,a.j4)(r)}var r=i(30757),u=i(63387),c=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const d=(0,a.aZ)({name:"App",setup:function(){u.Z.debug(u.Z.types.OTHER,"APP: Initialize"),r.b.initializeConfig()},mounted:function(){return c(this,void 0,void 0,(function*(){yield r.b.initialConnectionSetup()}))}});var l=i(74260);const m=(0,l.Z)(d,[["render",s]]),p=m;var h=i(30522),f=i(47083),v=i(79582);const g=[{path:"/",component:()=>Promise.all([i.e(736),i.e(912)]).then(i.bind(i,13912)),children:[{path:"",component:()=>Promise.all([i.e(736),i.e(5)]).then(i.bind(i,36005))}]},{path:"/connect/:address",component:()=>Promise.all([i.e(736),i.e(912)]).then(i.bind(i,13912))},{path:"/:catchAll(.*)*",component:()=>i.e(751).then(i.bind(i,76751))}],y=g,w=(0,f.BC)((function(){const e=v.r5,t=(0,v.p7)({scrollBehavior:()=>({left:0,top:0}),routes:y,history:e("")});return t}));async function A(e,t){const n="function"===typeof h["default"]?await(0,h["default"])({}):h["default"],{storeKey:a}=await Promise.resolve().then(i.bind(i,30522)),s="function"===typeof w?await w({store:n}):w;n.$router=s;const r=e(p);return r.use(o.Z,t),{app:r,store:n,storeKey:a,router:s}}var D=i(64434);const b={config:{dark:"auto"},plugins:{Notify:D.Z}},S="";async function E({app:e,router:t,store:i,storeKey:n},o){let a=!1;const s=e=>{try{return t.resolve(e).href}catch(i){}return Object(e)===e?null:e},r=e=>{if(a=!0,"string"===typeof e&&/^https?:\/\//.test(e))return void(window.location.href=e);const t=s(e);null!==t&&(window.location.href=t,window.location.reload())},u=window.location.href.replace(window.location.origin,"");for(let d=0;!1===a&&d<o.length;d++)try{await o[d]({app:e,router:t,store:i,ssrContext:null,redirect:r,urlPath:u,publicPath:S})}catch(c){return c&&c.url?void r(c.url):void console.error("[Quasar] boot error:",c)}!0!==a&&(e.use(t),e.use(i,n),e.mount("#q-app"))}A(n.ri,b).then((e=>Promise.all([Promise.resolve().then(i.bind(i,11768)),Promise.resolve().then(i.bind(i,14281))]).then((t=>{const i=t.map((e=>e.default)).filter((e=>"function"===typeof e));E(e,i)}))))},11768:(e,t,i)=>{i.r(t),i.d(t,{default:()=>r,api:()=>s});var n=i(47083),o=i(30052),a=i.n(o);const s=a().create({baseURL:"https://api.example.com"}),r=(0,n.xr)((({app:e})=>{e.config.globalProperties.$axios=a(),e.config.globalProperties.$api=s}))},14281:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ft});var n=i(47083),o=i(83673),a=i(62323),s=i(98880);const r={class:"row"},u={class:".col-4"},c={class:".col-8 row items-center"},d={key:0,class:"text-subtitle1 items-center"},l={key:1,class:"text-subtitle1 items-center"},m={class:"row q-mt-sm"},p={key:0,class:"text-caption row items-center"},h={key:1,class:"text-caption row items-center"},f={ref:"audioInputFeedbackPlayer"},v={key:0,class:"text-subtitle1 text-grey text-center"},g={class:".col-8 row items-center"},y={key:0,class:"text-subtitle1 items-center"},w={key:1,class:"text-subtitle1 items-center"};function A(e,t){const i=(0,o.up)("q-tab"),n=(0,o.up)("q-tabs"),A=(0,o.up)("q-separator"),D=(0,o.up)("q-btn"),b=(0,o.up)("q-radio"),S=(0,o.up)("q-list"),E=(0,o.up)("q-tab-panel"),C=(0,o.up)("q-tab-panels"),T=(0,o.up)("q-scroll-area"),I=(0,o.up)("q-card"),M=(0,o.up)("q-spinner-gears"),O=(0,o.up)("q-inner-loading"),_=(0,o.up)("OverlayShell");return(0,o.wg)(),(0,o.j4)(_,{icon:"headphones",title:"Audio",managerProps:e.propsToPass,defaultHeight:500,defaultWidth:400},{default:(0,o.w5)((()=>[(0,o.Wm)(I,{class:"column full-height"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tab=t),"active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:(0,o.w5)((()=>[(0,o.Wm)(i,{name:"input",label:"Input"}),(0,o.Wm)(i,{name:"output",label:"Output"})])),_:1},8,["modelValue"]),(0,o.Wm)(A),(0,o.Wm)(T,{class:"col"},{default:(0,o.w5)((()=>[(0,o.Wm)(C,{modelValue:e.tab,"onUpdate:modelValue":t[3]||(t[3]=t=>e.tab=t),animated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(E,{name:"input"},{default:(0,o.w5)((()=>[(0,o._)("div",r,[(0,o._)("div",u,[(0,o.Wm)(D,{fab:"",class:"q-mr-sm",color:e.$store.state.audio.user.hasInputAccess?"primary":"red",icon:e.$store.state.audio.user.muted?"mic_off":"mic",onClick:e.micToggled},null,8,["color","icon","onClick"])]),(0,o._)("div",c,[e.selectedInputStore?((0,o.wg)(),(0,o.iD)("span",d," Using "+(0,a.zw)(e.selectedInputStore),1)):((0,o.wg)(),(0,o.iD)("span",l," No microphone selected. "))])]),(0,o.wy)((0,o._)("div",m,[(0,o.Wm)(D,{flat:"",dense:"",round:"",class:"q-mr-sm",disabled:!e.$store.state.audio.user.hasInputAccess,color:e.isListeningToFeedback?"primary":"red",icon:e.isListeningToFeedback?"hearing":"hearing_disabled",onClick:e.toggleInputFeedback},null,8,["disabled","color","icon","onClick"]),e.isListeningToFeedback?((0,o.wg)(),(0,o.iD)("span",h," Speak into your microphone to listen. ")):((0,o.wg)(),(0,o.iD)("span",p," Click to test your microphone. ")),(0,o._)("audio",f,null,512)],512),[[s.F8,e.$store.state.audio.user.hasInputAccess]]),(0,o.Wm)(A,{class:"q-my-md"}),!1===e.$store.state.audio.user.hasInputAccess?((0,o.wg)(),(0,o.iD)("div",v," Please grant mic access to the app in order to speak. ")):((0,o.wg)(),(0,o.j4)(S,{key:1},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.$store.state.audio.inputsList,(i=>((0,o.wg)(),(0,o.iD)("div",{key:i.deviceId},[(0,o.Wm)(b,{onClick:t=>e.requestInputAccess(i.deviceId),modelValue:e.selectedInputStore,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selectedInputStore=t),val:i.label,label:i.label,color:"teal"},null,8,["onClick","modelValue","val","label"])])))),128))])),_:1}))])),_:1}),(0,o.Wm)(E,{name:"output"},{default:(0,o.w5)((()=>[(0,o._)("div",g,[e.selectedOutputStore?((0,o.wg)(),(0,o.iD)("span",y," Using "+(0,a.zw)(e.selectedOutputStore),1)):((0,o.wg)(),(0,o.iD)("span",w," No output selected. "))]),(0,o.Wm)(A,{class:"q-my-md"}),(0,o.Wm)(S,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.$store.state.audio.outputsList,(i=>((0,o.wg)(),(0,o.iD)("div",{key:i.deviceId},[(0,o.Wm)(b,{onClick:t=>e.requestOutputAccess(i.deviceId),modelValue:e.selectedOutputStore,"onUpdate:modelValue":t[2]||(t[2]=t=>e.selectedOutputStore=t),val:i.label,label:i.label,color:"teal"},null,8,["onClick","modelValue","val","label"])])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,o.Wm)(O,{showing:0===e.$store.state.audio.inputsList.length},{default:(0,o.w5)((()=>[(0,o.Wm)(M,{size:"50px",color:"primary"})])),_:1},8,["showing"])])),_:1},8,["managerProps"])}function D(e,t,i,n,r,u){const c=(0,o.up)("q-icon"),d=(0,o.up)("q-btn"),l=(0,o.up)("q-bar"),m=(0,o.up)("q-slide-transition"),p=(0,o.up)("q-card-section"),h=(0,o.up)("q-card");return(0,o.wg)(),(0,o.j4)(h,{class:"outer column no-wrap items-stretch",onMouseenter:t[13]||(t[13]=t=>e.hovered=!0),onMouseleave:t[14]||(t[14]=t=>e.hovered=!1),onMousedown:t[15]||(t[15]=t=>e.$emit("overlay-action","select")),style:(0,a.j5)({height:e.isMaximized?"100%":(e.showWindowContent?e.height:32)+"px",width:e.isMaximized?"100%":e.width+"px",top:e.isMaximized?"0px":e.top+"px",left:e.isMaximized?"0px":e.left+"px"})},{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(l,{class:"bar",style:(0,a.j5)(e.hoverShowBar?"position: absolute; width: 100%;":"")},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{name:e.icon},null,8,["name"]),(0,o._)("div",{class:"title",onMousedown:t[0]||(t[0]=t=>e.canMove&&e.beginAction(t,"move"))},(0,a.zw)(e.title),33),(0,o._)("div",{class:"col full-height",onMousedown:t[1]||(t[1]=t=>e.canMove&&e.beginAction(t,"move"))},null,32),(0,o.Wm)(d,{dense:"",flat:"",icon:"minimized"===e.overlayStatus?"flip_to_front":"minimize",onClick:t[2]||(t[2]=t=>e.$emit("overlay-action","minimize"))},null,8,["icon"]),(0,o.Wm)(d,{dense:"",flat:"",icon:"maximized"===e.overlayStatus?"flip_to_front":"crop_square",onClick:t[3]||(t[3]=t=>e.$emit("overlay-action","maximize"))},null,8,["icon"]),(0,o.Wm)(d,{dense:"",flat:"",icon:"close",onClick:t[4]||(t[4]=t=>e.$emit("overlay-action","close"))})])),_:1},8,["style"]),[[s.F8,e.showWindowTitleBar]])])),_:1}),(0,o.wy)((0,o.Wm)(p,{class:"col q-pa-none",style:(0,a.j5)(e.hoverShowBar?"margin-top: 32px;":"")},{default:(0,o.w5)((()=>[(0,o.WI)(e.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),[[s.F8,e.showWindowContent]]),e.canResize&&e.canResizeHeight&&!e.isMinimized&&!e.isMaximized?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"resize resize-top",onMousedown:t[5]||(t[5]=t=>e.beginAction(t,"resize-top"))},null,32)):(0,o.kq)("",!0),e.canResize&&e.canResizeHeight&&!e.isMinimized&&!e.isMaximized?((0,o.wg)(),(0,o.iD)("div",{key:1,class:"resize resize-bottom",onMousedown:t[6]||(t[6]=t=>e.beginAction(t,"resize-bottom"))},null,32)):(0,o.kq)("",!0),e.canResize&&e.canResizeWidth&&!e.isMaximized?((0,o.wg)(),(0,o.iD)("div",{key:2,class:"resize resize-left",onMousedown:t[7]||(t[7]=t=>e.beginAction(t,"resize-left"))},null,32)):(0,o.kq)("",!0),e.canResize&&e.canResizeWidth&&!e.isMaximized?((0,o.wg)(),(0,o.iD)("div",{key:3,class:"resize resize-right",onMousedown:t[8]||(t[8]=t=>e.beginAction(t,"resize-right"))},null,32)):(0,o.kq)("",!0),e.canResize&&e.canResizeHeight&&e.canResizeWidth&&!e.isMinimized&&!e.isMaximized?((0,o.wg)(),(0,o.iD)("div",{key:4,class:"resize resize-nw",onMousedown:t[9]||(t[9]=t=>e.beginAction(t,"resize-nw"))},null,32)):(0,o.kq)("",!0),e.canResize&&e.canResizeHeight&&e.canResizeWidth&&!e.isMinimized&&!e.isMaximized?((0,o.wg)(),(0,o.iD)("div",{key:5,class:"resize resize-ne",onMousedown:t[10]||(t[10]=t=>e.beginAction(t,"resize-ne"))},null,32)):(0,o.kq)("",!0),e.canResize&&e.canResizeHeight&&e.canResizeWidth&&!e.isMinimized&&!e.isMaximized?((0,o.wg)(),(0,o.iD)("div",{key:6,class:"resize resize-sw",onMousedown:t[11]||(t[11]=t=>e.beginAction(t,"resize-sw"))},null,32)):(0,o.kq)("",!0),e.canResize&&e.canResizeHeight&&e.canResizeWidth&&!e.isMinimized&&!e.isMaximized?((0,o.wg)(),(0,o.iD)("div",{key:7,class:"resize resize-se",onMousedown:t[12]||(t[12]=t=>e.beginAction(t,"resize-se"))},null,32)):(0,o.kq)("",!0)])),_:3},8,["style"])}const b=(0,o.aZ)({props:{icon:{type:String,required:!0},title:{type:String,required:!0},hoverShowBar:{type:Boolean,default:!1},defaultHeight:{type:Number,required:!0,default:400},defaultWidth:{type:Number,default:300},minimumHeight:{type:Number,default:50},minimumWidth:{type:Number,default:50},maximumHeight:{type:Number,default:void 0},maximumWidth:{type:Number,default:void 0},defaultTop:{type:Number,default:200},defaultLeft:{type:Number,default:400},minimumExposure:{type:Number,default:100},canMove:{type:Boolean,default:!0},canResize:{type:Boolean,default:!0},canResizeWidth:{type:Boolean,default:!0},canResizeHeight:{type:Boolean,default:!0},dragMoveDebounce:{type:Number,default:10},managerProps:{type:Object,default:()=>({})}},data:e=>({height:e.defaultHeight,width:e.defaultWidth,top:e.defaultTop,left:e.defaultLeft,overlayStatus:"restored",hovered:!1,dragAction:"UNKNOWN",dragStart:{x:0,y:0},mouseCaptured:!1,onDragMoveReady:!0}),computed:{isMaximized(){return"maximized"===this.overlayStatus},isMinimized(){return"minimized"===this.overlayStatus},showWindowTitleBar(){return!this.hoverShowBar||this.hovered||this.isMinimized||this.isMaximized},showWindowContent(){return!this.isMinimized}},watch:{mouseCaptured(e){e?(document.addEventListener("mousemove",this.onDragMove,!0),document.addEventListener("mouseup",this.onDragDone,!0)):(document.removeEventListener("mousemove",this.onDragMove,!0),document.removeEventListener("mouseup",this.onDragDone,!0))},"managerProps.overlayStatus"(e){this.overlayStatus=e}},methods:{dragBehavior(e){let t=0,i=0,n=0,o=0;switch(e){case"move":t=1,i=1;break;case"resize-top":t=1,o=-1;break;case"resize-bottom":o=1;break;case"resize-left":i=1,n=-1;break;case"resize-right":n=1;break;case"resize-nw":t=1,i=1,o=-1,n=-1;break;case"resize-ne":t=1,o=-1,n=1;break;case"resize-sw":i=1,n=-1,o=1;break;case"resize-se":o=1,n=1;break;default:break}return{top:t,left:i,width:n,height:o}},beginAction(e,t){this.dragAction&&"UNKNOWN"!==this.dragAction||(this.dragAction=t,this.dragStart={x:e.screenX,y:e.screenY},this.mouseCaptured=!0)},applyDrag(e,t){if(!this.dragAction||!this.dragStart)return;const i=this.dragBehavior(this.dragAction);let n=e-this.dragStart.x,o=t-this.dragStart.y,a=this.width+n*i.width;this.minimumWidth&&a<this.minimumWidth&&(a=this.minimumWidth,n=(a-this.width)*i.width),this.maximumWidth&&a>this.maximumWidth&&(a=this.maximumWidth,n=(a-this.width)*i.width);let s=this.height+o*i.height;this.minimumHeight&&s<this.minimumHeight&&(s=this.minimumHeight,o=(s-this.height)*i.height),this.maximumHeight&&s>this.maximumHeight&&(s=this.maximumHeight,o=(s-this.height)*i.height),this.width=a,this.height=s,this.top+=o*i.top,this.left+=n*i.left,this.dragStart={x:e,y:t}},onDragMove(e){this.onDragMoveReady&&(this.applyDrag(e.screenX,e.screenY),this.onDragMoveReady=!1,window.setTimeout((()=>{this.onDragMoveReady=!0}),this.dragMoveDebounce)),e.preventDefault(),e.stopPropagation()},onDragDone(e){this.applyDrag(e.screenX,e.screenY),this.mouseCaptured=!1,this.dragAction="UNKNOWN",this.dragStart={x:0,y:0},e.preventDefault(),e.stopPropagation()}},unmounted(){this.mouseCaptured&&(document.removeEventListener("mousemove",this.onDragMove,!0),document.removeEventListener("mouseup",this.onDragDone,!0))}});var S=i(74260),E=i(10151),C=i(82471),T=i(10846),I=i(24554),M=i(2165),O=i(25589),_=i(7518),N=i.n(_);const Z=(0,S.Z)(b,[["render",D],["__scopeId","data-v-37bbbd85"]]),U=Z;N()(b,"components",{QCard:E.Z,QSlideTransition:C.Z,QBar:T.Z,QIcon:I.Z,QBtn:M.Z,QCardSection:O.Z});var k=i(30522),P=i(72396),x=i(63387),W=i(38769),R=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const L=(0,o.aZ)({name:"Audio",$refs:{audioInputFeedbackPlayer:HTMLMediaElement},props:{propsToPass:{type:Object,default:()=>({}),required:!1}},components:{OverlayShell:U},data:()=>({tab:"input",isListeningToFeedback:!1,selectedInputDevice:void 0,selectedOutputDevice:void 0}),computed:{selectedInputStore:{get:function(){return this.$store.state.audio.user.currentInputDevice?this.$store.state.audio.user.currentInputDevice.label:"None selected"},set:function(e){const t=this.$store.state.audio.inputsList.filter((t=>t.label===e));if(1===t.length)return x.Z.debug(x.Z.types.AUDIO,`Audio.vue: set selectedInputStore. inputInfo=${(0,W.a)(t[0])}`),void(this.selectedInputDevice=t[0]);x.Z.debug(x.Z.types.AUDIO,"Audio.vue: set selectedInputStore. no device selected")}},selectedOutputStore:{get:function(){return this.$store.state.audio.user.currentOutputDevice?this.$store.state.audio.user.currentOutputDevice.label:"Default"},set:function(e){const t=this.$store.state.audio.outputsList.filter((t=>t.label===e));if(1===t.length)return x.Z.debug(x.Z.types.AUDIO,`Audio.vue: set selectedOutputStore. inputInfo=${(0,W.a)(t[0])}`),void(this.selectedOutputDevice=t[0]);x.Z.debug(x.Z.types.AUDIO,"Audio.vue: set selectedOutputStore. no device selected")}}},methods:{setAwaitingCapturePermissions(e){this.$store.commit(k.Mutations.MUTATE,{property:"audio.user.awaitingCapturePermissions",value:e})},requestInputAccess(e){return R(this,void 0,void 0,(function*(){this.$store.state.audio.user.userInputStream&&this.stopCurrentInputStream();const t=e?{audio:{deviceId:{exact:e}},video:!1}:{audio:!0,video:!1};if(!0===this.$store.state.audio.user.awaitingCapturePermissions)return x.Z.error(x.Z.types.AUDIO,`Failed to request specific input device ID ${null!==e&&void 0!==e?e:"audio"} due to an already awaiting request for input capture.`),null;this.setAwaitingCapturePermissions(!0);try{x.Z.debug(x.Z.types.AUDIO,`Audio.vue: requestInputAccess waiting. Constraint=${(0,W.a)(t)}`);const e=yield navigator.mediaDevices.getUserMedia(t);return e&&(x.Z.debug(x.Z.types.AUDIO,`Audio.vue: have stream id=${e.id}`),yield P.$.getAvailableInputOutputDevices(),yield P.$.setUserAudioInputStream(e,this.selectedInputDevice),this.setAwaitingCapturePermissions(!1)),e}catch(i){const e=i;this.setAwaitingCapturePermissions(!1),yield P.$.setUserAudioInputStream(void 0,void 0),x.Z.error(x.Z.types.AUDIO,`Error getting capture permissions: ${e.message}`)}return null}))},requestOutputAccess(e){this.$store.state.audio.user.userInputStream&&this.stopCurrentOutputStream(),P.$.setAudioOutputStream(this.selectedOutputDevice)},stopCurrentInputStream(){this.$store.state.audio.user.userInputStream&&this.$store.state.audio.user.userInputStream.getTracks().forEach((e=>{e.stop()})),this.revokeCaptureAccess()},stopCurrentOutputStream(){x.Z.debug(x.Z.types.AUDIO,"Audio.vue: stopCurrentOutputStream")},revokeCaptureAccess(){this.$store.commit(k.Mutations.MUTATE,{property:"audio.user",with:{connected:!1,currentInputDevice:void 0,userInputStream:void 0,hasInputAccess:!1}})},micToggled:function(){!0===this.$store.state.audio.user.hasInputAccess&&P.$.muteAudio()},toggleInputFeedback:function(){this.isListeningToFeedback=!this.isListeningToFeedback,!0===this.isListeningToFeedback?(this.$refs.audioInputFeedbackPlayer.muted=!1,this.$refs.audioInputFeedbackPlayer.play()):this.$refs.audioInputFeedbackPlayer.pause()},setFeedbackPlayerStream(e){this.isListeningToFeedback&&this.$refs.audioInputFeedbackPlayer&&("string"===typeof e?this.$refs.audioInputFeedbackPlayer.src=e:this.$refs.audioInputFeedbackPlayer.srcObject=e)}},unmounted:function(){this.isListeningToFeedback=!1,this.setFeedbackPlayerStream(null)}});var z=i(52496),$=i(3269),q=i(65869),V=i(47704),Q=i(5906),F=i(86602),G=i(27011),j=i(29337),B=i(66941),H=i(6394);const K=(0,S.Z)(L,[["render",A]]),Y=K;N()(L,"components",{QCard:E.Z,QTabs:z.Z,QTab:$.Z,QSeparator:q.Z,QScrollArea:V.Z,QTabPanels:Q.Z,QTabPanel:F.Z,QBtn:M.Z,QList:G.Z,QRadio:j.Z,QInnerLoading:B.Z,QSpinnerGears:H.Z});const J=["src"],X={key:1};function ee(e,t,i,n,r,u){const c=(0,o.up)("q-avatar"),d=(0,o.up)("q-chat-message"),l=(0,o.up)("q-card-section"),m=(0,o.up)("q-scroll-area"),p=(0,o.up)("q-input"),h=(0,o.up)("q-card"),f=(0,o.up)("OverlayShell");return(0,o.wg)(),(0,o.j4)(f,{icon:"chat",title:"Chat",managerProps:e.propsToPass,defaultHeight:300,defaultWidth:600,defaultLeft:0,defaultTop:400,hoverShowBar:!0,style:{background:"transparent","box-shadow":"none",border:"none"}},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{class:"column no-wrap items-stretch full-height",style:{background:"transparent","box-shadow":"none"}},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{class:"col",style:{height:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{class:"q-pt-none"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.$store.state.messages.messages,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.whenReceived},[(0,o.Wm)(d,{text:[e.msgText(t)],sent:e.msgSentBySelf(t),name:e.msgSender(t),stamp:e.msgTime(t),"text-color":"white","bg-color":"primary"},{avatar:(0,o.w5)((()=>[(0,o.Wm)(c,{color:"primary"},{default:(0,o.w5)((()=>[e.getProfilePicture(e.msgSender(t))?((0,o.wg)(),(0,o.iD)("img",{key:0,src:e.getProfilePicture(e.msgSender(t))},null,8,J)):((0,o.wg)(),(0,o.iD)("span",X,(0,a.zw)(e.msgSender(t).charAt(0)),1))])),_:2},1024)])),_:2},1032,["text","sent","name","stamp"])])))),128))])),_:1})])),_:1}),(0,o.Wm)(p,{class:"inputBox",placeholder:"Type a message...",outlined:"",modelValue:e.messageInput,"onUpdate:modelValue":t[0]||(t[0]=t=>e.messageInput=t),dense:!0,onKeydown:(0,s.D2)((0,s.iM)(e.submitMessage,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])])),_:1})])),_:1},8,["managerProps"])}var te=i(84484),ie=i(25395);const ne=(0,o.aZ)({name:"ChatWindow",props:{propsToPass:{type:Object,default:()=>({})}},components:{OverlayShell:U},data:()=>({messageInput:"",subscribed:!1,worldChatHistory:[{displayName:"Hallo",username:"nani",self:!1,timestamp:(new Date).toString(),message:"Hi, hru?"},{displayName:"Waifu",username:"testerino",self:!0,timestamp:(new Date).toString(),message:"Sup holmes."},{displayName:"Hallo",username:"nani",self:!1,timestamp:(new Date).toString(),message:"nammuch you?"},{displayName:"Waifu",username:"testerino",self:!0,timestamp:(new Date).toString(),message:"you know the life."}]}),computed:{},watch:{},methods:{getProfilePicture(e){return"testerino"===e?"https://cdn.quasar.dev/img/avatar4.jpg":null},msgSender(e){if(e.messageJSON){const t=e.messageJSON;return t.displayName}return e.senderId.stringify()},msgText(e){if(e.messageJSON){const t=e.messageJSON;return t.message}return e.message},msgTime(e){return e.whenReceived.toUTCString()},msgSentBySelf(e){var t;return null!==(t=e.self)&&void 0!==t&&t},submitMessage(){if(ie.M.ActiveDomain){const e=ie.M.ActiveDomain.MessageClient;if(e){const t={type:"TransmitChatMessage",channel:"Local",message:this.messageInput,colour:{red:255,blue:204,green:229},displayName:this.$store.state.avatar.displayName,position:this.$store.state.avatar.position};e.sendMessage(te.B.DefaultChatChannel,JSON.stringify(t)),this.messageInput=""}}}}});var oe=i(86115),ae=i(40629),se=i(75096),re=i(28104);const ue=(0,S.Z)(ne,[["render",ee],["__scopeId","data-v-4731fb10"]]),ce=ue;N()(ne,"components",{QField:oe.Z,QCard:E.Z,QScrollArea:V.Z,QCardSection:O.Z,QChatMessage:ae.Z,QAvatar:se.Z,QInput:re.Z,QInnerLoading:B.Z,QSpinnerGears:H.Z});const de=e=>((0,o.dD)("data-v-52ff9d7f"),e=e(),(0,o.Cn)(),e),le={class:"row"},me=de((()=>(0,o._)("div",{class:"exploreItemBackground"},null,-1)));function pe(e,t,i,n,r,u){const c=(0,o.up)("q-icon"),d=(0,o.up)("q-input"),l=(0,o.up)("q-btn"),m=(0,o.up)("q-item-section"),p=(0,o.up)("q-item-label"),h=(0,o.up)("q-badge"),f=(0,o.up)("q-item"),v=(0,o.up)("q-list"),g=(0,o.up)("q-scroll-area"),y=(0,o.up)("q-card"),w=(0,o.up)("q-spinner-gears"),A=(0,o.up)("q-inner-loading"),D=(0,o.up)("OverlayShell"),b=(0,o.Q2)("ripple");return(0,o.wg)(),(0,o.j4)(D,{icon:"travel_explore",title:"Explore",managerProps:e.propsToPass,defaultHeight:500,defaultWidth:400,defaultLeft:250,defaultTop:10,hoverShowBar:!0,style:(0,a.j5)({background:"rgba(0, 0, 0, 0.3)","box-shadow":"none",border:"none"})},{default:(0,o.w5)((()=>[(0,o.Wm)(y,{class:"column no-wrap items-stretch full-height",style:{background:"transparent","box-shadow":"none"}},{default:(0,o.w5)((()=>[(0,o._)("div",le,[(0,o.Wm)(d,{borderless:"",dense:"",filled:"",debounce:"300",modelValue:e.filterText,"onUpdate:modelValue":t[0]||(t[0]=t=>e.filterText=t),placeholder:"Search or enter location",class:"col","append-icon":"mdi-location-enter",onKeyup:(0,s.D2)(e.visitIconCallback,["enter"])},{append:(0,o.w5)((()=>[(0,o.Wm)(c,{name:"search"}),(0,o.wy)((0,o.Wm)(c,{name:"launch",onClick:e.visitIconCallback,clickable:""},null,8,["onClick"]),[[b]])])),_:1},8,["modelValue","onKeyup"])]),(0,o.Wm)(g,{class:"col exploreScrollContainer"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{showing:!e.loading},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.filteredAndSortedData,(t=>(0,o.wy)(((0,o.wg)(),(0,o.j4)(f,{key:t.placeId,clickable:"",onClick:i=>e.openLocation(t.address),style:(0,a.j5)(t.thumbnail?"background-image: url("+t.thumbnail+");":""),class:"exploreItem"},{default:(0,o.w5)((()=>[me,(0,o.Wm)(m,{side:"",top:""},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{round:"",color:"white",icon:"fas fa-info",clickable:"",onClick:(0,s.iM)((i=>e.openDetails(t)),["stop"]),class:"text-purple",size:"10px"},null,8,["onClick"])])),_:2},1024),(0,o.Wm)(m,{top:""},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{lines:"1",class:"textShadow"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.name),1)])),_:2},1024),(0,o.Wm)(p,{caption:"",lines:"1",class:"textShadow"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.description),1)])),_:2},1024)])),_:2},1024),(0,o.Wm)(m,{side:"",top:""},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{color:"white","text-color":"black"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.currentAttendance)+" ",1),(0,o.Wm)(c,{name:"people",size:"14px",class:"q-ml-xs"})])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick","style"])),[[b]]))),128))])),_:1},8,["showing"])])),_:1})])),_:1}),(0,o.Wm)(A,{showing:e.loading},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{size:"50px",color:"primary"})])),_:1},8,["showing"])])),_:1},8,["managerProps","style"])}var he=i(30757),fe=i(20749),ve=i(91626);const ge="/api/v1/places";var ye=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const we={getActiveList(){var e;return ye(this,void 0,void 0,(function*(){const t=[];if(null===(e=fe.w.ActiveMetaverse)||void 0===e?void 0:e.isConnected)try{const e=ge+"?status=online",i=yield(0,ve.YW)(e);i.places.forEach((e=>{t.push({name:e.name,placeId:e.placeId,address:e.address,description:e.description,thumbnail:e.thumbnail,currentAttendance:void 0===e.current_attendance?0:e.current_attendance})}))}catch(i){const e=(0,ve.GD)(i);x.Z.error(x.Z.types.PLACES,`Exception while attempting to get places: ${e}`)}else x.Z.error(x.Z.types.PLACES,"Attempt to get places when metaverse not connected");return t}))}};var Ae=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const De=(0,o.aZ)({name:"Explore",props:{propsToPass:{type:Object,default:()=>({})}},components:{OverlayShell:U},data(){return{placesList:[],loading:!1,filterText:""}},computed:{filteredAndSortedData:function(){let e=this.placesList;return e=e.filter((e=>!e.name.toLowerCase().indexOf(this.filterText.toLowerCase()))),e=e.sort(((e,t)=>e.currentAttendance>t.currentAttendance?-1:e.currentAttendance<t.currentAttendance?1:e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0)),e}},methods:{loadPlacesList(){return Ae(this,void 0,void 0,(function*(){this.loading=!0;const e=yield we.getActiveList();this.placesList=e,this.loading=!1}))},openLocation(e){return Ae(this,void 0,void 0,(function*(){x.Z.info(x.Z.types.UI,`Connecting to...${e}`),yield he.b.connectionSetup(e)}))},openDetails(e){alert("Not currently implemented: Show details - "+e.name)},visitIconCallback(){return Ae(this,void 0,void 0,(function*(){""!==this.filterText&&(yield this.openLocation(this.filterText))}))}},created:function(){return Ae(this,void 0,void 0,(function*(){yield this.loadPlacesList()}))}});var be=i(83414),Se=i(52035),Ee=i(2350),Ce=i(69721),Te=i(46489);const Ie=(0,S.Z)(De,[["render",pe],["__scopeId","data-v-52ff9d7f"]]),Me=Ie;N()(De,"components",{QField:oe.Z,QItem:be.Z,QCard:E.Z,QInput:re.Z,QIcon:I.Z,QScrollArea:V.Z,QList:G.Z,QItemSection:Se.Z,QBtn:M.Z,QItemLabel:Ee.Z,QBadge:Ce.Z,QInnerLoading:B.Z,QSpinnerGears:H.Z}),N()(De,"directives",{Ripple:Te.Z});const Oe=["src"],_e={key:1},Ne=(0,o.Uk)("Admin");function Ze(e,t,i,n,s,r){const u=(0,o.up)("q-avatar"),c=(0,o.up)("q-item-section"),d=(0,o.up)("q-item-label"),l=(0,o.up)("q-icon"),m=(0,o.up)("q-item"),p=(0,o.up)("q-list"),h=(0,o.up)("q-scroll-area"),f=(0,o.up)("q-card"),v=(0,o.up)("OverlayShell"),g=(0,o.Q2)("ripple");return(0,o.wg)(),(0,o.j4)(v,{icon:"people",title:"People",managerProps:e.propsToPass,defaultHeight:300,defaultWidth:300,defaultLeft:300,hoverShowBar:!0,style:(0,a.j5)({background:"rgba(0, 0, 0, 0.3)","box-shadow":"none",border:"none"})},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{class:"column no-wrap items-stretch full-height",style:{background:"transparent","box-shadow":"none"}},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{class:"col",style:{height:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.$store.state.avatars.avatarsInfo.values(),(t=>(0,o.wy)(((0,o.wg)(),(0,o.j4)(m,{key:t.sessionId,class:"q-mb-sm",clickable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{color:"primary"},{default:(0,o.w5)((()=>[e.getProfilePicture(t)?((0,o.wg)(),(0,o.iD)("img",{key:0,src:e.getProfilePicture(t)},null,8,Oe)):((0,o.wg)(),(0,o.iD)("span",_e,(0,a.zw)(e.getDisplayName(t)),1))])),_:2},1024)])),_:2},1024),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.getDisplayName(t)),1)])),_:2},1024),t.isAdmin?((0,o.wg)(),(0,o.j4)(d,{key:0,caption:"",lines:"1"},{default:(0,o.w5)((()=>[Ne])),_:1})):(0,o.kq)("",!0)])),_:2},1024),(0,o.Wm)(c,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{onClick:i=>e.complementMuted(t),color:t.muted?"red":"primary",name:t.muted?"volume_off":"volume_up"},null,8,["onClick","color","name"])])),_:2},1024)])),_:2},1536)),[[g]]))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["managerProps","style"])}const Ue=(0,o.aZ)({name:"People",props:{propsToPass:{type:Object,default:()=>({})},localWorld:{type:Boolean,default:!0},previewWorld:{type:String,default:void 0},friends:{type:Boolean,default:!1},connections:{type:Boolean,default:!1}},components:{OverlayShell:U},data:()=>({peopleList:[],testLocal:[{displayName:"Hallo",username:"nani",sessionUUID:"{123e4567-e89b-12d3-a456-426614174000}",volume:100,muted:!0,admin:!1},{displayName:"Waifu",username:"testerino",sessionUUID:"{56556655-12d3-12d3-a456-426614174000}",volume:90,muted:!1,admin:!0}],testPreview:[{displayName:"World",username:"preview",sessionUUID:"{65464565-12d3-12d3-a456-426614174000}",volume:100,muted:!0,admin:!1},{displayName:"Preview",username:"world",sessionUUID:"{76566666-12d3-12d3-a456-426614174000}",volume:90,muted:!1,admin:!0}],testFriends:[{displayName:"We",username:"wut",sessionUUID:"{96666687-12d3-12d3-a456-426614174000}",volume:100,muted:!0,admin:!1},{displayName:"RFriends",username:"hay",sessionUUID:"{43999992-12d3-12d3-a456-426614174000}",volume:90,muted:!1,admin:!0}],testConnections:[{displayName:"Nice",username:"to",sessionUUID:"{654-12d3-12d3-a456-426614174000}",volume:100,muted:!0,admin:!1},{displayName:"Meet",username:"you",sessionUUID:"{321-12d3-12d3-a456-426614174000}",volume:90,muted:!1,admin:!0}]}),computed:{},methods:{loadPeopleList(){!0===this.localWorld?this.peopleList=this.testLocal:this.previewWorld?this.peopleList=this.testPreview:!0===this.friends?this.peopleList=this.testFriends:!0===this.connections&&(this.peopleList=this.testConnections)},getProfilePicture(e){const t=this.getDisplayName(e);return t&&"testerino"===t?"https://cdn.quasar.dev/img/avatar4.jpg":null},getDisplayName(e){var t;return null!==(t=e.displayName)&&void 0!==t?t:"..."},complementMuted(e){const t=!e.muted;k.Store.commit(k.Mutations.UPDATE_AVATAR_VALUE,{sessionId:e.sessionId,field:"muted",value:t})}},created:function(){}});var ke=i(28396);const Pe=(0,S.Z)(Ue,[["render",Ze],["__scopeId","data-v-7a33aac7"]]),xe=Pe;N()(Ue,"components",{QField:oe.Z,QCard:E.Z,QScrollArea:V.Z,QList:G.Z,QItem:be.Z,QItemSection:Se.Z,QAvatar:se.Z,QItemLabel:Ee.Z,QIcon:I.Z,QSlider:ke.Z,QInnerLoading:B.Z,QSpinnerGears:H.Z}),N()(Ue,"directives",{Ripple:Te.Z});const We={key:0};function Re(e,t,i,n,s,r){const u=(0,o.up)("q-item-label"),c=(0,o.up)("q-icon"),d=(0,o.up)("q-item-section"),l=(0,o.up)("q-item"),m=(0,o.up)("q-separator"),p=(0,o.up)("q-list"),h=(0,o.up)("q-scroll-area"),f=(0,o.up)("q-card"),v=(0,o.up)("OverlayShell"),g=(0,o.Q2)("ripple");return(0,o.wg)(),(0,o.j4)(v,{icon:"menu",title:"Menu",managerProps:e.propsToPass,defaultHeight:300,defaultWidth:200,defaultLeft:10,defaultTop:10,hoverShowBar:!1,style:(0,a.j5)({background:"rgba(0, 0, 0, 0.6)","box-shadow":"none",border:"none"})},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{class:"column no-wrap items-stretch full-height",style:{background:"transparent","box-shadow":"none"}},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{class:"col",style:{height:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.userMenu,((t,i)=>((0,o.wg)(),(0,o.iD)(o.HY,{key:i},[t.devonly&&"development"!=e.buildMode?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("span",We,[t.isCategory?((0,o.wg)(),(0,o.j4)(u,{key:0,header:""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.label),1)])),_:2},1024)):(0,o.wy)(((0,o.wg)(),(0,o.j4)(l,{key:1,clickable:"",onClick:i=>t.action?t.action:e.$emit("overlay-action","openOverlay:"+(t.link||t.label))},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{name:t.icon},null,8,["name"])])),_:2},1024),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.label),1)])),_:2},1024)])),_:2},1032,["onClick"])),[[g]])])),t.separator?((0,o.wg)(),(0,o.j4)(m,{key:"sep"+i})):(0,o.kq)("",!0)],64)))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["managerProps","style"])}const Le=(0,o.aZ)({name:"People",props:{propsToPass:{type:Object,default:()=>({})},buildMode:{type:String,default:()=>"production"}},components:{OverlayShell:U},data:()=>({userMenu:[{icon:"people",label:"People",link:"",isCategory:!1,separator:!0,action:void 0},{icon:"chat",label:"Chat",link:"ChatWindow",isCategory:!1,separator:!0,action:void 0},{icon:"travel_explore",label:"Explore",link:"",isCategory:!1,separator:!0,action:void 0},{icon:"directions_bus",label:"Debug",link:"DebugWindow",isCategory:!1,separator:!0,action:void 0,devonly:!0}]}),computed:{},methods:{}}),ze=(0,S.Z)(Le,[["render",Re],["__scopeId","data-v-215483d4"]]),$e=ze;N()(Le,"components",{QField:oe.Z,QCard:E.Z,QScrollArea:V.Z,QList:G.Z,QItemLabel:Ee.Z,QItem:be.Z,QItemSection:Se.Z,QIcon:I.Z,QSeparator:q.Z,QInnerLoading:B.Z,QSpinnerGears:H.Z}),N()(Le,"directives",{Ripple:Te.Z});const qe=e=>((0,o.dD)("data-v-0f738957"),e=e(),(0,o.Cn)(),e),Ve=qe((()=>(0,o._)("div",null,null,-1)));function Qe(e,t,i,n,s,r){const u=(0,o.up)("q-tab"),c=(0,o.up)("q-tabs"),d=(0,o.up)("q-list"),l=(0,o.up)("q-tab-panel"),m=(0,o.up)("q-tab-panels"),p=(0,o.up)("OverlayShell");return(0,o.wg)(),(0,o.j4)(p,{icon:"directions_bus",title:"Debug",managerProps:e.propsToPass,defaultHeight:500,defaultWidth:600,defaultLeft:40,defaultTop:400,hoverShowBar:!0,style:(0,a.j5)({background:"rgba(0, 0, 0, 0.3)","box-shadow":"none",border:"none"})},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tab=t),dense:""},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{name:"Messages",icon:"chat",label:"Messages"}),(0,o.Wm)(u,{name:"Avatars",icon:"people",label:"Avatars"})])),_:1},8,["modelValue"]),(0,o.Wm)(m,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=t=>e.tab=t),animated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{name:"Messages"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.$store.state.messages.messages,(t=>((0,o.wg)(),(0,o.j4)(d,{key:t.id},{default:(0,o.w5)((()=>[(0,o._)("div",null,(0,a.zw)(e.msgSender(t))+" : "+(0,a.zw)(e.msgText(t)),1)])),_:2},1024)))),128))])),_:1}),(0,o.Wm)(l,{name:"Avatars"},{default:(0,o.w5)((()=>[(0,o._)("div",null,"DisplayName: "+(0,a.zw)(e.$store.state.avatar.displayName),1),(0,o._)("div",null,"Location: "+(0,a.zw)(e.$store.state.avatar.location),1),Ve,(0,o._)("div",null,"Avatars: "+(0,a.zw)(e.$store.state.avatars.count),1),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.$store.state.avatars.avatarsInfo.values(),(e=>((0,o.wg)(),(0,o.j4)(d,{key:e},{default:(0,o.w5)((()=>[(0,o._)("div",null,(0,a.zw)(e.stringify()),1)])),_:2},1024)))),128))])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["managerProps","style"])}const Fe=(0,o.aZ)({name:"DebugWindow",props:{propsToPass:{type:Object,default:()=>({})}},components:{OverlayShell:U},data:()=>({messageInput:"",tab:null,subscribed:!1}),computed:{},methods:{getProfilePicture(e){return"testerino"===e?"https://cdn.quasar.dev/img/avatar4.jpg":null},msgSender(e){if(e.messageJSON){const t=e.messageJSON;return t.displayName}return e.senderId.stringify()},msgText(e){if(e.messageJSON){const t=e.messageJSON;return t.message}return e.message}}}),Ge=(0,S.Z)(Fe,[["render",Qe],["__scopeId","data-v-0f738957"]]),je=Ge;N()(Fe,"components",{QField:oe.Z,QTabs:z.Z,QTab:$.Z,QTabPanels:Q.Z,QTabPanel:F.Z,QList:G.Z,QInnerLoading:B.Z,QSpinnerGears:H.Z});const Be=(0,o._)("div",{class:"title"},"Metaverse Login",-1);function He(e,t,i,n,a,s){const r=(0,o.up)("q-space"),u=(0,o.up)("q-btn"),c=(0,o.up)("q-bar"),d=(0,o.up)("q-tab"),l=(0,o.up)("q-tabs"),m=(0,o.up)("q-separator"),p=(0,o.up)("MetaverseLogin"),h=(0,o.up)("q-tab-panel"),f=(0,o.up)("MetaverseRegister"),v=(0,o.up)("q-tab-panels"),g=(0,o.up)("q-card-section");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(c,{class:"bar"},{default:(0,o.w5)((()=>[Be,(0,o.Wm)(r),(0,o.Wm)(u,{dense:"",flat:"",icon:"close",onClick:t[0]||(t[0]=t=>e.$emit("closeDialog","close"))})])),_:1}),(0,o.Wm)(g,{class:"q-pt-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=t=>e.tab=t),"active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{name:"metaverseLogin",label:"Login"}),(0,o.Wm)(d,{name:"metaverseRegister",label:"Register"})])),_:1},8,["modelValue"]),(0,o.Wm)(m),(0,o.Wm)(v,{modelValue:e.tab,"onUpdate:modelValue":t[3]||(t[3]=t=>e.tab=t),animated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{name:"metaverseLogin"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{onCloseDialog:t[2]||(t[2]=t=>e.$emit("closeDialog","close"))})])),_:1}),(0,o.Wm)(h,{name:"metaverseRegister"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{onRegisterSuccess:e.onMetaverseRegister},null,8,["onRegisterSuccess"])])),_:1})])),_:1},8,["modelValue"])])),_:1})],64)}const Ke={align:"right"};function Ye(e,t,i,n,a,s){const r=(0,o.up)("q-input"),u=(0,o.up)("q-icon"),c=(0,o.up)("q-btn"),d=(0,o.up)("q-form");return(0,o.wg)(),(0,o.j4)(d,{onSubmit:e.onSubmit,onReset:e.onReset,class:"q-gutter-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{modelValue:e.username,"onUpdate:modelValue":t[0]||(t[0]=t=>e.username=t),filled:"",label:"Username",hint:"Enter your username.","lazy-rules":"",rules:[e=>e&&e.length>0||"Please enter a username."]},null,8,["modelValue","rules"]),(0,o.Wm)(r,{modelValue:e.password,"onUpdate:modelValue":t[2]||(t[2]=t=>e.password=t),filled:"",label:"Password",type:e.showPassword?"text":"password",hint:"Enter your password.","lazy-rules":"",rules:[e=>e&&e.length>0||"Please enter a password."]},{append:(0,o.w5)((()=>[(0,o.Wm)(u,{name:e.showPassword?"visibility":"visibility_off",class:"cursor-pointer",onClick:t[1]||(t[1]=t=>e.showPassword=!e.showPassword)},null,8,["name"])])),_:1},8,["modelValue","type","rules"]),(0,o._)("div",Ke,[(0,o.Wm)(c,{label:"Reset",type:"reset",color:"primary",flat:"",class:"q-mr-sm"}),(0,o.Wm)(c,{label:"Login",type:"submit",color:"primary"})])])),_:1},8,["onSubmit","onReset"])}var Je=i(9684),Xe=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const et=(0,o.aZ)({name:"MetaverseLogin",emits:["closeDialog"],data:()=>({username:"",password:"",showPassword:!1}),methods:{onSubmit(){return Xe(this,void 0,void 0,(function*(){try{const e=yield Je.m.login(this.username,this.password);e?(this.$q.notify({type:"positive",textColor:"white",icon:"cloud_done",message:"Welcome "+this.username+"."}),this.$emit("closeDialog")):this.$q.notify({type:"negative",textColor:"white",icon:"warning",message:"Login attempted failed"})}catch(e){this.$q.notify({type:"negative",textColor:"white",icon:"warning",message:"Login attempted failed: "+e})}}))},onReset(){this.username="",this.password=""}}});var tt=i(68689);const it=(0,S.Z)(et,[["render",Ye]]),nt=it;N()(et,"components",{QForm:tt.Z,QInput:re.Z,QIcon:I.Z,QBtn:M.Z});const ot={align:"right"};function at(e,t,i,n,a,s){const r=(0,o.up)("q-input"),u=(0,o.up)("q-icon"),c=(0,o.up)("q-btn"),d=(0,o.up)("q-form");return(0,o.wg)(),(0,o.j4)(d,{onSubmit:e.onSubmit,onReset:e.onReset,class:"q-gutter-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{modelValue:e.username,"onUpdate:modelValue":t[0]||(t[0]=t=>e.username=t),filled:"",label:"Username",hint:"Enter your username.","lazy-rules":"",rules:[e=>e&&e.length>0||"Please enter a username."]},null,8,["modelValue","rules"]),(0,o.Wm)(r,{modelValue:e.email,"onUpdate:modelValue":t[1]||(t[1]=t=>e.email=t),filled:"",label:"Email",hint:"Enter your email.","lazy-rules":"",rules:[e=>e&&e.length>0||"Please enter an email."]},null,8,["modelValue","rules"]),(0,o.Wm)(r,{modelValue:e.password,"onUpdate:modelValue":t[3]||(t[3]=t=>e.password=t),filled:"",label:"Password",type:e.showPassword?"text":"password",hint:"Enter your password.","lazy-rules":"",rules:[e=>e&&e.length>0||"Please enter a password."]},{append:(0,o.w5)((()=>[(0,o.Wm)(u,{name:e.showPassword?"visibility":"visibility_off",class:"cursor-pointer",onClick:t[2]||(t[2]=t=>e.showPassword=!e.showPassword)},null,8,["name"])])),_:1},8,["modelValue","type","rules"]),(0,o.Wm)(r,{modelValue:e.confirmPassword,"onUpdate:modelValue":t[5]||(t[5]=t=>e.confirmPassword=t),filled:"",label:"Confirm Password",type:e.showConfirmPassword?"text":"password",hint:"Enter your password again.","lazy-rules":"",rules:[t=>t&&t.length>0&&t===e.password||"Please ensure your passwords match."]},{append:(0,o.w5)((()=>[(0,o.Wm)(u,{name:e.showConfirmPassword?"visibility":"visibility_off",class:"cursor-pointer",onClick:t[4]||(t[4]=t=>e.showConfirmPassword=!e.showConfirmPassword)},null,8,["name"])])),_:1},8,["modelValue","type","rules"]),(0,o._)("div",ot,[(0,o.Wm)(c,{label:"Reset",type:"reset",color:"primary",flat:"",class:"q-mr-sm"}),(0,o.Wm)(c,{label:"Register",type:"submit",color:"primary"})])])),_:1},8,["onSubmit","onReset"])}var st=i(48825),rt=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const ut=(0,o.aZ)({name:"MetaverseRegister",data:()=>({username:"",email:"",password:"",confirmPassword:"",showPassword:!1,showConfirmPassword:!1}),methods:{onSubmit(){return rt(this,void 0,void 0,(function*(){const e=(0,st.Z)();try{const e=yield Je.m.createAccount(this.username,this.password,this.email),t={data:{accountWaitingVerification:e}};this.$emit("register-success"),!0===t.data.accountWaitingVerification?this.$q.notify({type:"info",textColor:"white",icon:"email",timeout:0,message:"Check your email "+this.email+" to complete registration.",actions:[{label:"Dismiss",color:"white",handler:()=>{}}]}):this.$q.notify({type:"positive",textColor:"white",icon:"cloud_done",message:"Successfully registered "+this.username+"."})}catch(t){e.notify({type:"negative",textColor:"white",icon:"warning",message:"Failed to register: "+t})}}))},onReset(){this.username="",this.email="",this.password="",this.confirmPassword=""}}}),ct=(0,S.Z)(ut,[["render",at]]),dt=ct;N()(ut,"components",{QForm:tt.Z,QInput:re.Z,QIcon:I.Z,QBtn:M.Z});const lt=(0,o.aZ)({name:"Login",emits:["closeDialog"],components:{MetaverseLogin:nt,MetaverseRegister:dt},data:()=>({tab:"metaverseLogin"}),methods:{onMetaverseRegister(){this.tab="metaverseLogin"}}});var mt=i(62025);const pt=(0,S.Z)(lt,[["render",He]]),ht=pt;N()(lt,"components",{QBar:T.Z,QSpace:mt.Z,QBtn:M.Z,QCardSection:O.Z,QTabs:z.Z,QTab:$.Z,QSeparator:q.Z,QTabPanels:Q.Z,QTabPanel:F.Z});const ft=(0,n.xr)((({app:e})=>{e.component("Audio",Y),e.component("ChatWindow",ce),e.component("Explore",Me),e.component("People",xe),e.component("Menu",$e),e.component("DebugWindow",je),e.component("Login",ht),e.component("MetaverseLogin",nt),e.component("MetaverseRegister",dt)}))},73844:(e,t,i)=>{i.d(t,{rP:()=>n,pq:()=>o,KR:()=>a,NS:()=>s,Gi:()=>r,Y9:()=>u,PS:()=>c,pO:()=>d,d:()=>l,mb:()=>m,De:()=>h});const n="Reconnect_On_Startup",o="Default_Metaverse_Url",a="Last_Domain_Server",s="Default_Domain_Protocol",r="Default_Domain_Port",u="User_Audio_Input_Device",c="User_Audio_Output_Device",d="Log_Level",l="true",m="false",p={Default_Metaverse_Url:"https://metaverse.vircadia.com/live",Default_Domain_Protocol:"ws:",Default_Domain_Port:"40102"},h={_qualify:"",initialize(){h._setDefaultValues()},getItem(e,t,i=!1){const n=localStorage.getItem(i?"":h._qualify+e);if("string"!==typeof n){if(t)return t;throw new Error("Config.getItem: fetch of non-existant parameter: "+e)}return n},setItem(e,t,i=!1){localStorage.setItem(i?"":h._qualify+e,t)},setQualifier(e){e.endsWith(".")?h._qualify=e:h._qualify=e+"."},_setDefaultValues(){Object.keys(p).forEach((e=>{localStorage.setItem(e,p[e])}))}}},9684:(e,t,i)=>{i.d(t,{m:()=>h});var n=i(30052),o=i.n(n),a=i(20749),s=i(91626);const r="/oauth/token";var u=i(66381),c=i(86280),d=i(63387),l=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const m=1e3,p="Guest",h={isLoggedIn:!1,accountName:p,id:"UNKNOWN",accessToken:void 0,accessTokenType:void 0,accessTokenExpiration:void 0,refreshToken:void 0,scope:void 0,roles:[],createdAt:void 0,accountInfo:{},onAttributeChange:new c.DN,login(e,t){var i,n;return l(this,void 0,void 0,(function*(){if((null===(i=a.w.ActiveMetaverse)||void 0===i?void 0:i.isConnected)&&!h.isLoggedIn)try{const i=new URLSearchParams;i.append("grant_type","password"),i.append("username",e),i.append("password",t);const a=(0,s.Q2)(r),u=yield o().post(a,i);if(u.data){const t=u.data;if(t.error)return d.Z.error(d.Z.types.ACCOUNT,`Login failure. User ${e}`),!1;const i=u.data;return h.accountName=i.account_name,h.id=i.account_id,h.accessToken=i.access_token,h.accessTokenType=i.token_type,h.accessTokenExpiration=new Date(Date.now()+i.expires_in*m),h.refreshToken=i.refresh_token,h.scope=i.scope,h.roles=null!==(n=i.account_roles)&&void 0!==n?n:[],h.createdAt=new Date(Date.now()+i.created_at*m),h.isLoggedIn=!0,yield h.updateAccountInfo(),!0}}catch(u){const t=(0,s.GD)(u);return d.Z.error(d.Z.types.ACCOUNT,`Exception while attempting to login user ${e}: ${t}`),!1}else d.Z.error(d.Z.types.ACCOUNT,`Attempt to login when metaverse not connected: ${e}`);return!1}))},_emitAttributeChange(){d.Z.debug(d.Z.types.ACCOUNT,"emitAttributeChange:"),h.onAttributeChange.emit({isLoggedIn:h.isLoggedIn,isAdmin:"admin"in h.roles,accountName:h.accountName,id:h.id,accessToken:h.accessToken,accessTokenType:h.accessTokenType,accessTokenExpiration:h.accessTokenExpiration,refreshToken:h.refreshToken,scope:h.scope,roles:h.roles,createdAt:h.createdAt,accountInfo:h.accountInfo})},updateAccountInfo(){return l(this,void 0,void 0,(function*(){try{const e=yield(0,s.YW)(u.W0+h.id);h.accountInfo=e.account,h.accountName=e.account.username,h.roles=e.account.roles,h._emitAttributeChange()}catch(e){const t=(0,s.GD)(e);d.Z.error(d.Z.types.ACCOUNT,`Exception fetching account Info: ${h.accountName}: ${t}`)}}))},createAccount(e,t,i){return l(this,void 0,void 0,(function*(){const n={username:e,password:t,email:i};try{const e=yield(0,s.Hc)(u.bw,n);return h.accountName=e.username,h.id=e.accountId,e.accountAwaitingVerification}catch(o){const t=(0,s.GD)(o);return d.Z.error(d.Z.types.ACCOUNT,`Exception creating account: ${e}: ${t}`),!1}}))},logout(){return l(this,void 0,void 0,(function*(){h.accountName=p,h.accountInfo={},h.isLoggedIn=!1,h.accessToken="UNKNOWN",h._emitAttributeChange()}))}}},38769:(e,t,i)=>{function n(e){return JSON.stringify(e,((e,t)=>t instanceof BigInt?"BitInt":"undefined"===typeof t?"undef":t))}i.d(t,{a:()=>n})},63387:(e,t,i)=>{i.d(t,{Z:()=>o});const n=function(){let e,t;(function(e){e["ACCOUNT"]="[ACCOUNT]",e["AUDIO"]="[AUDIO]",e["AVATAR"]="[AVATAR]",e["COMM"]="[COMM]",e["ENTITIES"]="[ENTITIES]",e["METAVERSE"]="[METAVERSE]",e["MESSAGES"]="[MESSAGES]",e["OTHER"]="[OTHER]",e["PEOPLE"]="[PEOPLE]",e["PLACES"]="[PLACES]",e["UI"]="[UI]"})(e||(e={})),function(e){e["ERROR"]="[ERROR]",e["DEBUG"]="[DEBUG]",e["WARN"]="[WARN]",e["INFO"]="[INFO]"}(t||(t={}));let i=t.DEBUG;function n(e,t,i){console.info(e,t,i)}function o(e,o){i===t.DEBUG&&n(e,t.DEBUG,o)}function a(e,i){n(e,t.ERROR,i)}function s(e,o){i in[t.WARN,t.DEBUG,t.ERROR]&&n(e,t.WARN,o)}function r(e,i){n(e,t.INFO,i)}function u(n){switch(n){case"none":i=t.INFO;break;case"info":i=t.INFO;break;case"[INFO]":i=t.INFO;break;case"warn":i=t.WARN;break;case"[WARN]":i=t.WARN;break;case"debug":i=t.DEBUG;break;case"[DEBUG]":i=t.DEBUG;break;default:i=t.DEBUG}r(e.OTHER,`Logging level set to ${i}`)}return{types:e,levels:t,logLevel:i,print:n,setLogLevel:u,debug:o,error:a,warn:s,info:r}}(),o=n},34206:(e,t,i)=>{i.d(t,{i:()=>d});var n,o,a=i(23757),s=i(86280),r=i(63387),u=function(e,t,i,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,i):o?o.value=i:t.set(e,i),i},c=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class d extends a.K{constructor(e){super(),n.set(this,void 0),o.set(this,void 0),u(this,n,e,"f"),this.onStateChange=new s.DN,u(this,o,new s.hT(e.ContextId),"f"),c(this,o,"f").audioWorkletRelativePath="./js/",c(this,o,"f").onStateChanged=this._handleOnStateChanged.bind(this)}get Mixer(){return c(this,o,"f")}get clientState(){var e,t;return null!==(t=null===(e=c(this,o,"f"))||void 0===e?void 0:e.state)&&void 0!==t?t:a.G.DISCONNECTED}_handleOnStateChanged(e){r.Z.debug(r.Z.types.AUDIO,`DomainAudio: state change = ${d.stateToString(e)}`),this.onStateChange.emit(c(this,n,"f"),this,e)}getDomainAudioStream(){var e;return null===(e=c(this,o,"f"))||void 0===e?void 0:e.audioOutput}get mute(){var e,t;return null===(t=null===(e=c(this,o,"f"))||void 0===e?void 0:e.inputMuted)||void 0===t||t}play(){var e;null===(e=c(this,o,"f"))||void 0===e||e.play()}pause(){var e;null===(e=c(this,o,"f"))||void 0===e||e.pause()}}n=new WeakMap,o=new WeakMap},64697:(e,t,i)=>{i.d(t,{Q:()=>f});var n,o,a,s,r,u,c=i(23757),d=i(30522),l=i(86280),m=i(63387),p=function(e,t,i,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,i):o?o.value=i:t.set(e,i),i},h=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class f extends c.K{constructor(e){super(),n.set(this,void 0),o.set(this,void 0),a.set(this,void 0),s.set(this,void 0),r.set(this,void 0),u.set(this,void 0),p(this,n,e,"f"),p(this,r,void 0,"f"),p(this,u,void 0,"f"),p(this,o,new l.$N(e.ContextId),"f"),this.onStateChange=new l.DN,h(this,o,"f").onStateChanged=this._handleOnStateChanged.bind(this),p(this,s,l.AO.ZERO,"f"),h(this,o,"f").myAvatar.displayNameChanged.connect(this._handleOnMyAvatarNameChanged.bind(this)),h(this,o,"f").myAvatar.sessionDisplayNameChanged.connect(this._handleOnMyAvatarNameChanged.bind(this)),p(this,a,new Map,"f"),h(this,o,"f").avatarList.avatarAdded.connect(this._handleOnAvatarAdded.bind(this)),h(this,o,"f").avatarList.avatarRemoved.connect(this._handleOnAvatarRemoved.bind(this)),this._updateOtherAvatarInfo()}get Mixer(){return h(this,o,"f")}get MyAvatar(){var e;return null===(e=h(this,o,"f"))||void 0===e?void 0:e.myAvatar}get clientState(){var e,t;return null!==(t=null===(e=h(this,o,"f"))||void 0===e?void 0:e.state)&&void 0!==t?t:c.G.DISCONNECTED}update(){if(h(this,o,"f")){if(h(this,o,"f").update(),h(this,o,"f").myAvatar){const e=Object.assign({},h(this,o,"f").myAvatar.position);e!==h(this,s,"f")&&(p(this,s,e,"f"),this._updateAvatarPosition(e))}this._updateOtherAvatarInfo()}}_handleOnStateChanged(e){var t,i;m.Z.debug(m.Z.types.AVATAR,`DomainAvatar: AvatarMixer state=${l.$N.stateToString(null!==(i=null===(t=h(this,o,"f"))||void 0===t?void 0:t.state)&&void 0!==i?i:c.G.DISCONNECTED)}`),e===c.G.CONNECTED?this.startGameLoop():this.stopGameLoop(),this.onStateChange.emit(h(this,n,"f"),this,e)}startGameLoop(){"undefined"===typeof h(this,r,"f")&&(p(this,u,this.update.bind(this),"f"),p(this,r,setTimeout(h(this,u,"f"),100),"f"))}stopGameLoop(){h(this,r,"f")&&h(this,u,"f")&&(setTimeout(h(this,u,"f"),0),p(this,r,void 0,"f"))}_handleOnMyAvatarNameChanged(){this._updateMyAvatarInfo()}_handleOnAvatarAdded(e){if(m.Z.debug(m.Z.types.AVATAR,`DomainAvatar: Avatar added: ${e.stringify()}`),h(this,o,"f")){const t=h(this,o,"f").avatarList.getAvatar(e);t?h(this,a,"f").has(e)?m.Z.error(m.Z.types.AVATAR,`DomainAvatar: attempt to add avatar that is already in list: ${e.stringify()}`):(t.sessionDisplayNameChanged.connect(this._updateOtherAvatarInfo.bind(this)),h(this,a,"f").set(e,t)):m.Z.error(m.Z.types.AVATAR,`DomainAvatar: avatar added but no info: ${e.stringify()}`)}this._updateOtherAvatarInfo()}_handleOnAvatarRemoved(e){m.Z.debug(m.Z.types.AVATAR,`DomainAvatar: Avatar removed: ${e.stringify()}`);const t=h(this,a,"f").get(e);t&&(t.sessionDisplayNameChanged.disconnect(this._updateOtherAvatarInfo.bind(this)),h(this,a,"f").delete(e)),this._updateOtherAvatarInfo()}_updateMyAvatarInfo(){const e={domain:h(this,n,"f"),domainAvatar:this};d.Store.dispatch(d.Actions.UPDATE_AVATAR_INFO,e)}_updateOtherAvatarInfo(){const e={domain:h(this,n,"f"),domainAvatar:this,avatarsInfo:h(this,a,"f")};d.Store.dispatch(d.Actions.UPDATE_AVATAR_INFO,e)}_updateAvatarPosition(e){const t={domain:h(this,n,"f"),domainAvatar:this,position:e};d.Store.dispatch(d.Actions.UPDATE_AVATAR_INFO,t)}static positionAsString(e){const t=2;let i="0,0,0";return e&&e.x&&e.y&&e.z&&(i=`${e.x.toFixed(t)},${e.y.toFixed(t)},${e.z.toFixed(t)}`),i}}n=new WeakMap,o=new WeakMap,a=new WeakMap,s=new WeakMap,r=new WeakMap,u=new WeakMap},23757:(e,t,i)=>{i.d(t,{G:()=>n,K:()=>a});var n,o=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};(function(e){e[e["UNAVAILABLE"]=0]="UNAVAILABLE",e[e["DISCONNECTED"]=1]="DISCONNECTED",e[e["CONNECTED"]=2]="CONNECTED"})(n||(n={}));class a{static stateToString(e){let t="UNKNOWN";switch(e){case n.DISCONNECTED:t="DISCONNECTED";break;case n.CONNECTED:t="CONNECTED";break;case n.UNAVAILABLE:t="UNAVAILABLE";break;default:t="DISCONNECTED";break}return t}static waitABit(e){return o(this,void 0,void 0,(function*(){return new Promise((t=>{setTimeout(t,e)}))}))}waitUntilConnected(e){return o(this,void 0,void 0,(function*(){const t=100;return new Promise(((i,s)=>{(()=>{o(this,void 0,void 0,(function*(){let o=null!==e&&void 0!==e?e:3e5;while(this.clientState!==n.CONNECTED)yield a.waitABit(t),o-=t,o<0&&s(new Error("timeout"));i(this)}))})()}))}))}}},90062:(e,t,i)=>{i.d(t,{em:()=>A,qp:()=>D});var n,o,a,s,r,u=i(86280),c=i(34206),d=i(84484),l=i(64697),m=i(30522),p=i(73844),h=i(63387),f=i(23757),v=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))},g=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},y=function(e,t,i,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,i):o?o.value=i:t.set(e,i),i};const w={DOMAIN_URL:"Domain.Url"};var A;(function(e){e[e["DISCONNECTED"]=0]="DISCONNECTED",e[e["CONNECTING"]=1]="CONNECTING",e[e["CONNECTED"]=2]="CONNECTED",e[e["REFUSED"]=3]="REFUSED",e[e["ERROR"]=4]="ERROR"})(A||(A={}));class D{constructor(){n.set(this,"UNKNOWN"),o.set(this,void 0),a.set(this,void 0),s.set(this,void 0),r.set(this,void 0),this.waitForConnectedMS=200,this.onStateChange=new u.DN,this.restorePersistentVariables()}get DomainUrl(){return g(this,n,"f")}get DomainClient(){return g(this,o,"f")}get AudioClient(){return g(this,a,"f")}get MessageClient(){return g(this,s,"f")}get AvatarClient(){return g(this,r,"f")}get ContextId(){var e,t;return null!==(t=null===(e=g(this,o,"f"))||void 0===e?void 0:e.contextID)&&void 0!==t?t:0}get DomainState(){var e,t;return null!==(t=null===(e=g(this,o,"f"))||void 0===e?void 0:e.state)&&void 0!==t?t:u.zG.DISCONNECTED}get DomainStateAsString(){return g(this,o,"f")?u.zG.stateToString(g(this,o,"f").state):u.zG.stateToString(u.zG.DISCONNECTED)}static get DISCONNECTED(){return u.zG.stateToString(u.zG.DISCONNECTED)}static get CONNECTING(){return u.zG.stateToString(u.zG.CONNECTING)}static get CONNECTED(){return u.zG.stateToString(u.zG.CONNECTED)}static get REFUSED(){return u.zG.stateToString(u.zG.REFUSED)}static get ERROR(){return u.zG.stateToString(u.zG.ERROR)}static stateToString(e){return u.zG.stateToString(e)}connect(e){return v(this,void 0,void 0,(function*(){if(g(this,o,"f"))throw h.Z.error(h.Z.types.COMM,"Attempt to connect to domain when already connected"),new Error("Attempt to connect to domain when already connected");return y(this,n,D.cleanDomainUrl(e),"f"),h.Z.debug(h.Z.types.COMM,"Creating a new DomainServer"),y(this,o,new u.zG,"f"),y(this,r,new l.Q(this),"f"),y(this,s,new d.B(this),"f"),y(this,a,new c.i(this),"f"),h.Z.debug(h.Z.types.COMM,`Connecting to domain at ${g(this,n,"f")}`),g(this,o,"f").onStateChanged=this._handleOnDomainStateChange.bind(this),g(this,o,"f").connect(g(this,n,"f")),this}))}disconnect(){return v(this,void 0,void 0,(function*(){h.Z.info(h.Z.types.COMM,`Domain: disconnect of domain ${this.DomainUrl}`),g(this,o,"f")&&(g(this,o,"f").disconnect(),y(this,o,void 0,"f"))}))}_handleOnDomainStateChange(e,t){var i;h.Z.debug(h.Z.types.COMM,`DomainStateChange: new state ${D.stateToString(e)}, ${t}`),this.onStateChange.emit(this,e,t),m.Store.dispatch(m.Actions.UPDATE_DOMAIN,{domain:this,newState:null===(i=g(this,o,"f"))||void 0===i?void 0:i.state,info:t})}waitForConnected(){var e;return v(this,void 0,void 0,(function*(){while("undefined"===typeof g(this,o,"f"))yield f.K.waitABit(this.waitForConnectedMS);while((null===(e=g(this,o,"f"))||void 0===e?void 0:e.state)!==A.CONNECTED)yield f.K.waitABit(this.waitForConnectedMS);return this}))}get isConnected(){var e;return(null===(e=g(this,o,"f"))||void 0===e?void 0:e.state)===u.zG.CONNECTED}getMetaverseUrl(){return v(this,void 0,void 0,(function*(){return p.De.getItem(p.pq)}))}static cleanDomainUrl(e){let t=e.toLowerCase();t.startsWith("http://")&&(t=t.substring(7)),t.startsWith("https://")&&(t=t.substring(8)),t.startsWith("ws://")||t.startsWith("wss://")||(t=p.De.getItem(p.NS)+"//"+t);const i=/:\d*$/u.exec(t);return Array.isArray(i)||(t=t+":"+p.De.getItem(p.Gi)),t}storePersistentVariables(){p.De.setItem(w.DOMAIN_URL,g(this,n,"f"))}restorePersistentVariables(){y(this,n,p.De.getItem(w.DOMAIN_URL,"UNKNOWN"),"f")}}n=new WeakMap,o=new WeakMap,a=new WeakMap,s=new WeakMap,r=new WeakMap},25395:(e,t,i)=>{i.d(t,{M:()=>c});var n=i(73844),o=i(86280),a=i(23757),s=i(90062),r=i(63387),u=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const c={_activeDomain:void 0,_domains:new Map,get ActiveDomain(){return c._activeDomain},set ActiveDomain(e){var t;c._activeDomain&&(r.Z.debug(r.Z.types.OTHER,"DomainMgr: setting active domain. Disconnecting old"),c._activeDomain.onStateChange.disconnect(c._handleActiveDomainStateChange)),c._activeDomain=e,e&&(r.Z.debug(r.Z.types.OTHER,"DomainMgr: setting active domain"),e.onStateChange.connect(c._handleActiveDomainStateChange),(null===(t=e.DomainClient)||void 0===t?void 0:t.state)===s.em.CONNECTED&&(r.Z.debug(r.Z.types.OTHER,"DomainMgr: setting active domain. Domain already CONNECTED"),c._handleActiveDomainStateChange(e,e.DomainClient.state,"init")))},onActiveDomainStateChange:new o.DN,waitForActiveDomainConnected(){return u(this,void 0,void 0,(function*(){while("undefined"===typeof c._activeDomain)yield a.K.waitABit(200);return yield c._activeDomain.waitForConnected(),c._activeDomain}))},domainFactory(e){return u(this,void 0,void 0,(function*(){r.Z.debug(r.Z.types.COMM,`DomainMgr.domainFactory: creating domain ${e}`);const t=new s.qp;try{yield t.connect(e),c._domains.set(t.DomainUrl,t),n.De.setItem(n.KR,t.DomainUrl)}catch(i){throw r.Z.error(r.Z.types.COMM,`Exception connecting to domain ${e}`),i}return t}))},_handleActiveDomainStateChange(e,t,i){r.Z.debug(r.Z.types.OTHER,`DomainMgr: onActiveDomainStateChange.emit. state=${s.qp.stateToString(t)}`),c.onActiveDomainStateChange.emit(e,t,i)},shutdown(){return u(this,void 0,void 0,(function*(){r.Z.info(r.Z.types.COMM,"DomainMgr: shutdown")}))}}},84484:(e,t,i)=>{i.d(t,{B:()=>m});var n,o,a,s=i(23757),r=i(30522),u=i(86280),c=i(63387),d=function(e,t,i,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,i):o?o.value=i:t.set(e,i),i},l=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};class m extends s.K{constructor(e){super(),n.set(this,void 0),o.set(this,void 0),a.set(this,void 0),d(this,n,e,"f"),this.onStateChange=new u.DN,d(this,o,new u.Ny(e.ContextId),"f"),l(this,o,"f").onStateChanged=this._handleOnStateChanged.bind(this),l(this,o,"f").messageReceived.connect(this._handleOnMessageReceived.bind(this)),d(this,a,!1,"f")}get Mixer(){return l(this,o,"f")}subscribeChannel(e){return!(!l(this,o,"f")||l(this,o,"f").state!==s.G.CONNECTED)&&(l(this,o,"f").subscribe(e),!0)}unsubscribeChannel(e){l(this,o,"f")&&l(this,o,"f").unsubscribe(e)}sendMessage(e,t,i=!1){l(this,o,"f")&&l(this,o,"f").sendMessage(e,t,i)}get clientState(){var e,t;return null!==(t=null===(e=l(this,o,"f"))||void 0===e?void 0:e.state)&&void 0!==t?t:s.G.DISCONNECTED}_handleOnStateChanged(e){l(this,o,"f")?(c.Z.debug(c.Z.types.COMM,`DomainMessage: MessageMixer state=${u.Ny.stateToString(l(this,o,"f").state)}`),l(this,o,"f").state===s.G.CONNECTED?l(this,a,"f")||(this.subscribeChannel(m.DefaultChatChannel),this.subscribeChannel(m.DefaultSystemNotificationChannel),d(this,a,!0,"f")):d(this,a,!1,"f"),this._updateMessageInfo()):c.Z.error(c.Z.types.COMM,"DomainMessage: no MessageMixer"),this.onStateChange.emit(l(this,n,"f"),this,e)}_updateMessageInfo(){}_handleOnMessageReceived(e,t,i,n){let o;if(t&&t.length>0&&"{"===t[0])try{o=JSON.parse(t)}catch(s){o=void 0}const a={whenReceived:new Date,channel:e,message:t,messageJSON:o,senderId:i,localOnly:n};r.Store.dispatch(r.Actions.RECEIVE_CHAT_MESSAGE,a)}}n=new WeakMap,o=new WeakMap,a=new WeakMap,m.DefaultChatChannel="Chat",m.DefaultSystemNotificationChannel="System-Notifications"},66381:(e,t,i)=>{i.d(t,{DU:()=>n,W0:()=>o,bw:()=>a});const n="/api/metaverse_info",o="/api/v1/account/",a="/api/v1/users"},20749:(e,t,i)=>{i.d(t,{w:()=>E});var n,o,a,s,r,u,c,d=i(30052),l=i.n(d),m=i(91626),p=i(66381),h=i(30522),f=i(86280),v=i(73844),g=i(63387),y=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))},w=function(e,t,i,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,i):o?o.value=i:t.set(e,i),i},A=function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};(function(e){e["UNITIALIZED"]="Uninitialized",e["CONNECTING"]="Connecting",e["CONNECTED"]="Connected",e["ERROR"]="Error"})(c||(c={}));const D={METAVERSE_URL:"Metaverse.Url",METAVERSE_NAME:"Metaverse.Name",METAVERSE_NICK_NAME:"Metaverse.NickName"};class b{constructor(){n.set(this,v.De.getItem(v.pq)),o.set(this,c.UNITIALIZED),a.set(this,"UNKNOWN"),s.set(this,"UNKN"),r.set(this,void 0),u.set(this,"V0.0.0"),w(this,o,c.UNITIALIZED,"f"),this.onStateChange=new f.DN,this._restorePersistentVariables()}get MetaverseUrl(){return A(this,n,"f")}get ConnectionState(){return A(this,o,"f")}get MetaverseName(){return A(this,a,"f")}get MetaverseNickname(){return A(this,s,"f")}get IceServer(){return A(this,r,"f")}get ServerVersion(){return A(this,u,"f")}get isConnected(){return A(this,o,"f")===c.CONNECTED}setMetaverseUrl(e){var t;return y(this,void 0,void 0,(function*(){this._setMetaverseConnectionState(c.CONNECTING);const i=(0,m.Kd)(e),d=(0,m.Q2)(p.DU,i);try{const e=yield l().get(d),i=e.data;w(this,n,(0,m.Kd)(i.metaverse_url),"f"),w(this,a,i.metaverse_name,"f"),w(this,s,null!==(t=i.metaverse_nick_name)&&void 0!==t?t:i.metaverse_name,"f"),w(this,r,i.ice_server_url,"f"),w(this,u,i.metaverse_server_version["version-tag"],"f"),w(this,o,c.CONNECTED,"f"),g.Z.info(g.Z.types.METAVERSE,`Set new metaverse URL=${A(this,n,"f")}, name=${A(this,a,"f")}`),this._setMetaverseConnectionState(c.CONNECTED)}catch(h){const e=(0,m.GD)(h);g.Z.error(g.Z.types.COMM,`setMetaverseUrl: Exception fetching metaverseInfo: ${e}`),this._setMetaverseConnectionState(c.ERROR)}}))}_setMetaverseConnectionState(e){w(this,o,e,"f"),this.onStateChange.emit(this,e),h.Store.dispatch(h.Actions.UPDATE_METAVERSE,{metaverse:this,newState:e})}_storePersistentVariables(){v.De.setItem(D.METAVERSE_URL,A(this,n,"f")),v.De.setItem(D.METAVERSE_NAME,A(this,a,"f")),v.De.setItem(D.METAVERSE_NICK_NAME,A(this,s,"f"))}_restorePersistentVariables(){w(this,n,v.De.getItem(D.METAVERSE_URL,v.De.getItem(v.pq)),"f"),w(this,a,v.De.getItem(D.METAVERSE_NAME,"UNKNOWN"),"f"),w(this,s,v.De.getItem(D.METAVERSE_NICK_NAME,"UNKN"),"f")}}n=new WeakMap,o=new WeakMap,a=new WeakMap,s=new WeakMap,r=new WeakMap,u=new WeakMap;var S=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const E={_activeMetaverse:void 0,get ActiveMetaverse(){return E._activeMetaverse},set ActiveMetaverse(e){E._activeMetaverse=e},metaverseFactory(e){return S(this,void 0,void 0,(function*(){const t=new b;return"string"===typeof e&&e.length>0&&(yield t.setMetaverseUrl(e)),t}))}}},91626:(e,t,i)=>{i.d(t,{GD:()=>c,Kd:()=>d,Q2:()=>l,YW:()=>p,Hc:()=>h});var n=i(30052),o=i.n(n),a=i(20749),s=i(63387),r=i(9684),u=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};function c(e){if("string"===typeof e)return e;const t=e;return"message"in t?t.message:`Error: ${JSON.stringify(e)}`}function d(e){let t=e;while(t.endsWith("/"))t=t.slice(0,-1);return t}function l(e,t){return(null!==t&&void 0!==t?t:a.w.ActiveMetaverse.MetaverseUrl)+e}function m(){var e;const t={};return r.m.accessToken&&r.m.accessToken.length>10&&(t.headers={Authorization:(null!==(e=r.m.accessTokenType)&&void 0!==e?e:"Bearer")+" "+r.m.accessToken}),t}function p(e,t){var i;return u(this,void 0,void 0,(function*(){const n=l(e,t);let a="";try{const t=yield o().get(n,m()),s=t.data;if(s&&s.status){if("success"===s.status)return s.data;a=`${null!==(i=s.error)&&void 0!==i?i:"unspecified"}`}else a=`Poorly formed response to GET ${e}: ${JSON.stringify(t)}`}catch(r){const t=c(r);s.Z.error(s.Z.types.OTHER,`Exception on GET ${e}: ${t}`),a=`Exception on GET ${e}: ${t}`}throw new Error(a)}))}function h(e,t){var i;return u(this,void 0,void 0,(function*(){const n=l(e);try{const a=yield o().post(n,t,m()),s=a.data;if(s.status&&"success"===s.status)return s.data;throw new Error(`Error return on POST ${e}: ${null!==(i=s.error)&&void 0!==i?i:"??"}`)}catch(a){throw s.Z.error(s.Z.types.OTHER,`Exception on ${e}: ${a.message}`),new Error(`Exception on POST ${e}: ${a.message}`)}}))}},72396:(e,t,i)=>{i.d(t,{$:()=>l});var n=i(25395),o=i(90062),a=i(34206),s=i(23757),r=i(30522),u=i(73844),c=i(63387),d=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const l={_setAudioOutputFunction:void 0,initialize(e){return d(this,void 0,void 0,(function*(){c.Z.debug(c.Z.types.AUDIO,"AudioMgr.initialize()"),l._setAudioOutputFunction=e,n.M.onActiveDomainStateChange.connect(l._handleActiveDomainStateChange.bind(this));const t=yield l.getAudioInputAccess();yield l.getAvailableInputOutputDevices(),yield l.setInitialInputAudioDevice(t),yield l.setInitialOutputAudioDevice()}))},muteAudio(e){const t=null!==e&&void 0!==e?e:!r.Store.state.audio.user.muted;return r.Store.state.audio.user.muted!==t&&(r.Store.commit(r.Mutations.MUTATE,{property:"audio.user.muted",value:t}),l.setDomainAudioMuted(t),l.setUserAudioMuted(t)),t},_handleActiveDomainStateChange(e,t,i){(()=>{d(this,void 0,void 0,(function*(){t===o.em.CONNECTED?(c.Z.debug(c.Z.types.AUDIO,"AudioMgr._handleActiveDomainStateChange: CONNECTED"),e.AudioClient&&(e.AudioClient.onStateChange.connect(l._handleDomainAudioStateChange.bind(this)),e.AudioClient.clientState===s.G.CONNECTED&&(yield l._setupDomainAudio(e)))):(c.Z.debug(c.Z.types.AUDIO,`AudioMgr._handleActiveDomainStateChange: ${o.qp.stateToString(t)}`),l._setAudioOutputFunction&&l._setAudioOutputFunction(void 0))}))})()},_handleDomainAudioStateChange(e,t,i){(()=>{d(this,void 0,void 0,(function*(){c.Z.debug(c.Z.types.AUDIO,`AudioMgr._handleAudioStateChange: ${a.i.stateToString(i)}`),i===s.G.CONNECTED?yield l._setupDomainAudio(e):l._disconnectInputAndOutputStreams(e)}))})()},_setupDomainAudio(e){var t;return d(this,void 0,void 0,(function*(){c.Z.debug(c.Z.types.AUDIO,"AudioMgr._setupDomainAudio");const i=null===(t=e.AudioClient)||void 0===t?void 0:t.Mixer;i&&(l.setDomainAudioMuted(i.inputMuted),yield l._connectInputStreamsToOutputStreams(e))}))},_connectInputStreamsToOutputStreams(e){return d(this,void 0,void 0,(function*(){if(c.Z.debug(c.Z.types.AUDIO,"AudioMgr._connectInputAndOutputStreams"),e.AudioClient&&e.AudioClient.Mixer)if(r.Store.state.audio.user.userInputStream?yield l.setAudioToDomain(r.Store.state.audio.user.userInputStream):c.Z.debug(c.Z.types.AUDIO,"AudioMgr._connectInputAndOutputStreams. Have mixer but no user mic"),l._setAudioOutputFunction&&l._setAudioOutputFunction(e.AudioClient.getDomainAudioStream()),l._setAudioOutputFunction){const t=e.AudioClient;if(t){const e=t.getDomainAudioStream();l._setAudioOutputFunction(e)}else c.Z.debug(c.Z.types.AUDIO,"AudioMgr._connectInputAndOutputStreams. Could not set domain audio because no mixer")}else c.Z.debug(c.Z.types.AUDIO,"AudioMgr._connectInputAndOutputStreams. No output assignment function so no audio output")}))},_disconnectInputAndOutputStreams(e){e.AudioClient&&e.AudioClient.Mixer&&(e.AudioClient.Mixer.audioInput=null,l._setAudioOutputFunction&&l._setAudioOutputFunction(void 0))},setUserAudioInputStream(e,t){return d(this,void 0,void 0,(function*(){r.Store.commit(r.Mutations.MUTATE,{property:"audio.user",with:{connected:Boolean(e),awaitingCapturePermissions:!1,hasInputAccess:Boolean(e),userInputStream:e,currentInputDevice:t}});const i="undefined"===typeof e||null===e;l.muteAudio(i),t&&u.De.setItem(u.Y9,t.deviceId),yield this.setAudioToDomain(e)}))},setAudioToDomain(e){var t,i;return d(this,void 0,void 0,(function*(){if(n.M.ActiveDomain&&n.M.ActiveDomain.AudioClient&&n.M.ActiveDomain.AudioClient.clientState===s.G.CONNECTED){const o=null===(i=null===(t=n.M.ActiveDomain)||void 0===t?void 0:t.AudioClient)||void 0===i?void 0:i.Mixer;o&&(o.audioInput=e,l.setDomainAudioMuted(o.inputMuted),yield l.setDomainAudioPlayPause(!0))}}))},setDomainAudioPlayPause(e){return d(this,void 0,void 0,(function*(){if(n.M.ActiveDomain&&n.M.ActiveDomain.AudioClient&&n.M.ActiveDomain.AudioClient.clientState===s.G.CONNECTED){const t=n.M.ActiveDomain.AudioClient.Mixer;if(t)return e?yield t.play():yield t.pause(),e}return!1}))},setDomainAudioMuted(e){const t=null!==e&&void 0!==e?e:!r.Store.state.audio.user.muted;if(n.M.ActiveDomain&&n.M.ActiveDomain.AudioClient&&n.M.ActiveDomain.AudioClient.clientState===s.G.CONNECTED){const e=n.M.ActiveDomain.AudioClient.Mixer;e&&(e.inputMuted=t)}return t},setUserAudioMuted(e){const t=null!==e&&void 0!==e?e:!r.Store.state.audio.user.muted;return c.Z.debug(c.Z.types.AUDIO,`AudioMgr.setUserAudioMuted: ${String(t)}`),t},setAudioOutputStream(e){var t;r.Store.commit(r.Mutations.MUTATE,{property:"audio.user",with:{currentOutputDevice:e}}),e&&u.De.setItem(u.PS,e.deviceId);const i=null===(t=n.M.ActiveDomain)||void 0===t?void 0:t.AudioClient;if(i&&i.clientState===s.G.CONNECTED){const e=i.getDomainAudioStream();c.Z.debug(c.Z.types.AUDIO,"AudioMgr.setAudioOutputStream: setting output. "+typeof e),l._setAudioOutputFunction&&l._setAudioOutputFunction(e)}},getStreamForDeviceInfo(e){return d(this,void 0,void 0,(function*(){const t={audio:{deviceId:{exact:e.deviceId}},video:!1},i=yield navigator.mediaDevices.getUserMedia(t);return i}))},getDeviceInfoForStream(e){return d(this,void 0,void 0,(function*(){const t=e.getTracks().map((e=>e.getSettings().deviceId)),i=yield navigator.mediaDevices.enumerateDevices(),n=i.filter((e=>t.includes(e.deviceId)));if(n.length>0)return c.Z.debug(c.Z.types.AUDIO,`AudioMgr.getDeviceInfoForStream: returning ${n[0].label}`),n[0];c.Z.debug(c.Z.types.AUDIO,"AudioMgr.getDeviceInfoForStream: no device info found")}))},getAvailableInputOutputDevices(){return d(this,void 0,void 0,(function*(){c.Z.debug(c.Z.types.AUDIO,"AudioMgr.getAvailableInputOutputDevices");let e=[],t=[];if(navigator.mediaDevices){const i=yield navigator.mediaDevices.enumerateDevices();e=i.filter((e=>"audioinput"===e.kind)),c.Z.debug(c.Z.types.AUDIO,`AudioMgr: getAvailableInputOutputDevices. input count=${e.length}`),t=i.filter((e=>"audiooutput"===e.kind)),c.Z.debug(c.Z.types.AUDIO,`AudioMgr: getAvailableInputOutputDevices. output count=${t.length}`)}r.Store.commit(r.Mutations.MUTATE,{property:"audio",with:{inputsList:e,outputsList:t}})}))},getAudioInputAccess(){return d(this,void 0,void 0,(function*(){let e;if(navigator.mediaDevices)try{const t=u.De.getItem(u.Y9,"none"),i="none"===t?{video:!1,audio:!0}:{audio:{deviceId:{exact:t}},video:!1};e=yield navigator.mediaDevices.getUserMedia(i),c.Z.debug(c.Z.types.AUDIO,"AudioMgr.getAudioInputAccess: have user input stream"),r.Store.commit(r.Mutations.MUTATE,{property:"audio.user.hasInputAccess",value:!0})}catch(t){c.Z.error(c.Z.types.AUDIO,"EXCEPTION getting audio device access")}return e}))},setInitialInputAudioDevice(e){return d(this,void 0,void 0,(function*(){c.Z.debug(c.Z.types.AUDIO,"AudioMgr.getInitialInputAudioDevice");try{if(c.Z.debug(c.Z.types.AUDIO,"AudioMgr: set inital Input audio device"),e)yield l.setUserAudioInputStream(e,yield l.getDeviceInfoForStream(e));else if(r.Store.state.audio.inputsList.length>0){const e=r.Store.state.audio.inputsList[0];yield l.setUserAudioInputStream(yield l.getStreamForDeviceInfo(e),e)}}catch(t){const e=t;c.Z.error(c.Z.types.AUDIO,`Exception setting initial audio device: ${e.message}`),yield l.setUserAudioInputStream(void 0,void 0)}}))},setInitialOutputAudioDevice(){return d(this,void 0,void 0,(function*(){c.Z.debug(c.Z.types.AUDIO,"AudioMgr.getInitialOutputAudioDevice");const e=u.De.getItem(u.PS,"none");try{if("none"===e)if(c.Z.debug(c.Z.types.AUDIO,"AudioMgr: set inital output audio device"),r.Store.state.audio.outputsList.length>0){const e=r.Store.state.audio.outputsList[0];l.setAudioOutputStream(e)}else l.setAudioOutputStream(void 0);else{const t=r.Store.state.audio.outputsList.filter((t=>t.deviceId===e));if(t.length>0){c.Z.debug(c.Z.types.AUDIO,"AudioMgr: Found output audio device from last session");const e=t[0];l.setAudioOutputStream(e)}else{c.Z.debug(c.Z.types.AUDIO,"AudioMgr: Did not found output audio device from last session");const e=r.Store.state.audio.outputsList[0];l.setAudioOutputStream(e)}}}catch(t){l.setAudioOutputStream(void 0)}}))}}},30757:(e,t,i)=>{i.d(t,{b:()=>u});var n=i(20749),o=i(25395),a=i(73844),s=i(63387),r=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};const u={initializeConfig(){a.De.initialize(),s.Z.setLogLevel(a.De.getItem(a.pO,"debug"))},initialConnectionSetup(){return r(this,void 0,void 0,(function*(){if(a.De.getItem(a.rP,a.mb)===a.d){s.Z.info(s.Z.types.METAVERSE,"Doing Reconnect on Startup");const e=a.De.getItem(a.KR,void 0);e&&(yield u.connectionSetup(e))}else s.Z.info(s.Z.types.COMM,'Not performing Reconnect on Startup. See "config"');if(!n.w.ActiveMetaverse){const e=a.De.getItem(a.pq,"");yield u.metaverseConnectionSetup(e)}}))},connectionSetup(e){return r(this,void 0,void 0,(function*(){if(e)try{yield this.disconnectActiveDomain(),s.Z.debug(s.Z.types.COMM,`connectionSetup: connecting to domain ${e}`);const t=yield o.M.domainFactory(e);yield this.connectActiveDomain(t);const i=yield t.getMetaverseUrl();yield u.metaverseConnectionSetup(i)}catch(t){const e=t;s.Z.error(s.Z.types.COMM,`Exception connecting: ${e.message}`)}}))},metaverseConnectionSetup(e){return r(this,void 0,void 0,(function*(){try{if(e){s.Z.debug(s.Z.types.COMM,`metaverseConnectionSetup: connecting to metaverse ${e}`);const t=yield n.w.metaverseFactory(e);n.w.ActiveMetaverse=t}}catch(t){const e=t;s.Z.error(s.Z.types.COMM,`Exception connecting to metaverse: ${e.message}`)}}))},connectActiveDomain(e){return r(this,void 0,void 0,(function*(){o.M.ActiveDomain=e}))},disconnectActiveDomain(){return r(this,void 0,void 0,(function*(){o.M.ActiveDomain&&(yield o.M.ActiveDomain.disconnect(),o.M.ActiveDomain=void 0)}))}}},30522:(e,t,i)=>{i.r(t),i.d(t,{Actions:()=>u,Mutations:()=>r,Store:()=>g,default:()=>y,storeKey:()=>w,useStore:()=>A});var n=i(47083),o=i(87874);const a=JSON.parse('{"i8":"2022.1.12","N$":"Vircadia Web"}'),s=JSON.parse('{"NK":"2022.1.12-20220607-bb7bc0a"}');var r,u,c=i(86280),d=i(20749),l=i(90062),m=i(23757),p=i(64697),h=i(63387),f=i(38769),v=function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function r(e){try{u(n["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):o(e.value).then(s,r)}u((n=n.apply(e,t||[])).next())}))};(function(e){e["MUTATE"]="STATE_MUTATE",e["ADD_MESSAGE"]="ADD_MESSAGE",e["UPDATE_AVATAR_VALUE"]="UPDATE_AVATAR_VALUE"})(r||(r={})),function(e){e["SET_METAVERSE_URL"]="SET_METAVERSE_URL",e["SET_DOMAIN_URL"]="SET_DOMAIN_URL",e["UPDATE_METAVERSE"]="UPDATE_METAVERSE",e["UPDATE_DOMAIN"]="UPDATE_DOMAIN",e["UPDATE_ACCOUNT_TOKEN"]="UPDATE_ACCOUNT_TOKEN",e["UPDATE_ACCOUNT_INFO"]="UPDATE_ACCOUNT_INFO",e["UPDATE_AVATAR_INFO"]="UPDATE_AVATAR_INFO",e["RECEIVE_CHAT_MESSAGE"]="RECEIVE_CHAT_MESSAGE"}(u||(u={}));const g=(0,o.MT)({state:()=>{var e;return{globalConsts:{APP_NAME:a.N$,APP_VERSION:a.i8,APP_VERSION_TAG:s.NK,SDK_VERSION_TAG:null!==(e=c.w5.verboseVersion)&&void 0!==e?e:"probably 0.0.4",SAFETY_BEFORE_SESSION_TIMEOUT:21600},debugging:{},notifications:{},error:{title:"",code:"",full:""},dialog:{which:"NONE",show:!1},domain:{connectionState:l.qp.stateToString(l.em.DISCONNECTED),url:""},avatars:{connectionState:p.Q.stateToString(m.G.DISCONNECTED),count:0,avatarsInfo:new Map},avatar:{displayName:"",position:c.AO.ZERO,location:"0,0,0"},messages:{messages:[],nextMessageId:22},audio:{inputsList:[],outputsList:[],user:{connected:!1,hasInputAccess:!1,muted:!1,awaitingCapturePermissions:!1,currentInputDevice:void 0,currentOutputDevice:void 0,userInputStream:void 0}},metaverse:{connectionState:"",name:"",nickname:"",server:"",iceServer:void 0,serverVersion:void 0},account:{username:"Guest",isLoggedIn:!1,accessToken:"UNKNOWN",tokenType:"Bearer",scope:"UNKNOWN",isAdmin:!1,useAsAdmin:!1,images:{}},renderer:{focusSceneId:0,fps:1,cameraLocation:void 0,cameraRotation:void 0}}},mutations:{[r.MUTATE](e,t){t&&t.property&&"renderer"!==t.property&&h.Z.debug(h.Z.types.OTHER,`MUTATE: ${(0,f.a)(t)}`);let i=e;const n=t.property.split(".");while(n.length>1){const e=n.shift();e&&(e in i?i=i[e]:(h.Z.error(h.Z.types.OTHER,`State.MUTATE: non-existant target segment "${e}"`),h.Z.error(h.Z.types.OTHER,`State.MUTATE:     payload=${JSON.stringify(t)}`)))}const o=n[0];if(i&&o)if(t["with"]){const e=t["with"];Object.keys(e).forEach((t=>{i[o][t]=e[t]}))}else i[o]=t.value},[r.ADD_MESSAGE](e,t){const i=t.message;if("undefined"===typeof i.id&&(i.id=e.messages.nextMessageId,e.messages.nextMessageId+=1),e.messages.messages.push(t.message),"number"===typeof t.maxMessages)while(e.messages.messages.length>t.maxMessages)e.messages.messages.pop()},[r.UPDATE_AVATAR_VALUE](e,t){const i=e.avatars.avatarsInfo.get(t.sessionId);if(i){const e=i;typeof e[t.field]!==typeof t.value&&(h.Z.error(h.Z.types.OTHER,"UPDATE_AVATAR_VALUE: types don't match."),h.Z.error(h.Z.types.OTHER,`     id=${i.sessionId.stringify()}, field=${t.field}`)),e[t.field]=t.value}}},actions:{[u.UPDATE_METAVERSE](e,t){return v(this,void 0,void 0,(function*(){const i=t.metaverse;e.commit(r.MUTATE,{property:"metaverse",with:{name:i.MetaverseName,nickname:i.MetaverseNickname,connectionState:t.newState,server:i.MetaverseUrl,iceServer:i.IceServer,serverVersion:i.ServerVersion}})}))},[u.UPDATE_DOMAIN](e,t){return v(this,void 0,void 0,(function*(){e.commit(r.MUTATE,{property:"domain",with:{connectionState:l.qp.stateToString(t.newState),url:t.domain.DomainUrl}})}))},[u.UPDATE_ACCOUNT_INFO](e,t){return v(this,void 0,void 0,(function*(){h.Z.debug(h.Z.types.OTHER,"StoreAction.UpdateAccountInfo");const i=t.accountInfo;e.commit(r.MUTATE,{property:"account",with:{username:i.username,isLoggedIn:t.isLoggedIn,accessToken:t.accessToken,tokenType:t.accessTokenType,scope:t.scope,isAdmin:t.isAdmin}}),i.images?g.commit(r.MUTATE,{property:"account.images",value:i.images}):g.commit(r.MUTATE,{property:"account.images",value:{}})}))},[u.UPDATE_AVATAR_INFO](e,t){var i,n,o,a,s;return v(this,void 0,void 0,(function*(){h.Z.debug(h.Z.types.OTHER,"StoreAction.UpdateAvatarInfo");const u=null!==(n=null===(i=t.domain.DomainClient)||void 0===i?void 0:i.location)&&void 0!==n?n:"Unconnected";if(t.domainAvatar){const i=t.domainAvatar.MyAvatar;i?e.commit(r.MUTATE,{property:"avatar",with:{displayName:i.displayName?i.displayName:i.sessionDisplayName,position:null===i||void 0===i?void 0:i.position,location:`${u}/${p.Q.positionAsString(null===i||void 0===i?void 0:i.position)}`}}):e.commit(r.MUTATE,{property:"avatar",with:{displayName:"none",position:c.AO.ZERO,location:`${u}/${p.Q.positionAsString(c.AO.ZERO)}`}})}if(t.position&&e.commit(r.MUTATE,{property:"avatar",with:{position:t.position,location:`${u}/${p.Q.positionAsString(t.position)}`}}),t.avatarsInfo){const i=this.state.avatars.avatarsInfo,n=new Map;t.avatarsInfo.forEach(((e,t)=>{const o=i.get(t);if(o){const i=Object.assign({},o);i.position=e.position,i.displayName=e.displayName?e.displayName:e.sessionDisplayName,n.set(t,i)}else n.set(t,{sessionId:t,volume:50,muted:!1,isAdmin:!1,isValid:e.isValid,displayName:e.displayName?e.displayName:e.sessionDisplayName,position:e.position})})),e.commit(r.MUTATE,{property:"avatars",with:{connectionState:p.Q.stateToString(null!==(s=null===(a=null===(o=t.domainAvatar)||void 0===o?void 0:o.Mixer)||void 0===a?void 0:a.state)&&void 0!==s?s:m.G.DISCONNECTED),avatarsInfo:n,count:n.size}})}}))},[u.RECEIVE_CHAT_MESSAGE](e,t){e.commit(r.ADD_MESSAGE,{message:t,maxMessages:100})},[u.SET_METAVERSE_URL](e,t){return v(this,void 0,void 0,(function*(){yield d.w.ActiveMetaverse.setMetaverseUrl(t)}))}},strict:Boolean(!1)}),y=(0,n.h)((function(){return g})),w=Symbol("vuex-key");function A(){return(0,o.oR)(w)}}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,i),a.exports}i.m=e,(()=>{var e=[];i.O=(t,n,o,a)=>{if(!n){var s=1/0;for(d=0;d<e.length;d++){for(var[n,o,a]=e[d],r=!0,u=0;u<n.length;u++)(!1&a||s>=a)&&Object.keys(i.O).every((e=>i.O[e](n[u])))?n.splice(u--,1):(r=!1,a<s&&(s=a));if(r){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,o,a]}})(),(()=>{i.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return i.d(t,{a:t}),t}})(),(()=>{i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}})(),(()=>{i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[]))})(),(()=>{i.u=e=>"js/"+e+"."+{5:"a288f99d",751:"b77692f5",912:"0c8a04e2"}[e]+".js"})(),(()=>{i.miniCssF=e=>"css/"+{143:"app",736:"vendor"}[e]+"."+{143:"b1d4dbfd",736:"a46d55e6"}[e]+".css"})(),(()=>{i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="vircadia-web:";i.l=(n,o,a,s)=>{if(e[n])e[n].push(o);else{var r,u;if(void 0!==a)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var l=c[d];if(l.getAttribute("src")==n||l.getAttribute("data-webpack")==t+a){r=l;break}}r||(u=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,i.nc&&r.setAttribute("nonce",i.nc),r.setAttribute("data-webpack",t+a),r.src=n),e[n]=[o];var m=(t,i)=>{r.onerror=r.onload=null,clearTimeout(p);var o=e[n];if(delete e[n],r.parentNode&&r.parentNode.removeChild(r),o&&o.forEach((e=>e(i))),t)return t(i)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=m.bind(null,r.onerror),r.onload=m.bind(null,r.onload),u&&document.head.appendChild(r)}}})(),(()=>{i.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{i.p=""})(),(()=>{var e={143:0};i.f.j=(t,n)=>{var o=i.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var a=new Promise(((i,n)=>o=e[t]=[i,n]));n.push(o[2]=a);var s=i.p+i.u(t),r=new Error,u=n=>{if(i.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var a=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;r.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",r.name="ChunkLoadError",r.type=a,r.request=s,o[1](r)}};i.l(s,u,"chunk-"+t,t)}},i.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[s,r,u]=n,c=0;if(s.some((t=>0!==e[t]))){for(o in r)i.o(r,o)&&(i.m[o]=r[o]);if(u)var d=u(i)}for(t&&t(n);c<s.length;c++)a=s[c],i.o(e,a)&&e[a]&&e[a][0](),e[s[c]]=0;return i.O(d)},n=self["webpackChunkvircadia_web"]=self["webpackChunkvircadia_web"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n=i.O(void 0,[736],(()=>i(32101)));n=i.O(n)})();